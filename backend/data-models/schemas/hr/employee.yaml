version: '0.1'
metadata:
  domain: hr
  priority: medium
  estimatedEffort: 1-week
  blocksKPIs: 10+
  status: draft

entity:
  name: Employee
  description: |
    Employee master data for HR, payroll, and labor tracking.
    Essential for headcount, turnover, productivity, revenue per employee KPIs.
    Blocks 10+ HR and labor KPIs.
  
  tables:
    - name: employees
      description: Employee master records

  properties:
    # Core Identity
    id:
      type: uuid
      description: UUIDv7 primary key
      constraints:
        - primary_key
        - default: uuid_generate_v7()
    
    tenant_id:
      type: uuid
      description: Multi-tenant isolation
      constraints:
        - not_null
        - foreign_key: tenants.id
        - indexed
    
    # Employee Info
    employee_number:
      type: varchar(20)
      description: Company employee ID
      constraints:
        - not_null
        - unique
    
    first_name:
      type: varchar(50)
      constraints:
        - not_null
    
    last_name:
      type: varchar(50)
      constraints:
        - not_null
    
    email:
      type: varchar(100)
      constraints:
        - unique
    
    phone:
      type: varchar(20)
    
    # Employment
    hire_date:
      type: date
      description: Original hire date
      constraints:
        - not_null
    
    termination_date:
      type: date
      description: Last day of employment (null if active)
    
    employment_status:
      type: varchar(20)
      description: Current status
      values:
        - active
        - on_leave
        - terminated
        - retired
      constraints:
        - not_null
        - default: active
    
    termination_reason:
      type: varchar(30)
      values:
        - voluntary_resignation
        - involuntary_termination
        - retirement
        - end_of_contract
        - other
    
    # Position
    department:
      type: varchar(50)
      description: Department/division
      values:
        - production
        - prepress
        - finishing
        - warehouse
        - quality
        - maintenance
        - sales
        - administration
        - management
      constraints:
        - not_null
    
    job_title:
      type: varchar(100)
      constraints:
        - not_null
    
    manager_id:
      type: uuid
      description: Reports to
      constraints:
        - foreign_key: employees.id
    
    # Employment Type
    employment_type:
      type: varchar(20)
      values:
        - full_time
        - part_time
        - contract
        - temporary
        - seasonal
      constraints:
        - not_null
    
    fte_percentage:
      type: decimal
      description: Full-time equivalent (1.0 = 100%)
      constraints:
        - not_null
        - default: 1.0
        - check: fte_percentage > 0 AND fte_percentage <= 1.0
    
    # Compensation
    hourly_rate:
      type: decimal
      description: Hourly pay rate
      constraints:
        - check: hourly_rate >= 0
    
    annual_salary:
      type: decimal
      description: Annual salary (for salaried employees)
      constraints:
        - check: annual_salary >= 0
    
    overtime_eligible:
      type: boolean
      description: Eligible for overtime pay
      constraints:
        - not_null
        - default: true
    
    overtime_multiplier:
      type: decimal
      description: Overtime rate multiplier (e.g., 1.5)
      constraints:
        - default: 1.5
        - check: overtime_multiplier >= 1.0
    
    # Skills & Certifications
    skill_level:
      type: varchar(20)
      description: Skill proficiency
      values:
        - trainee
        - operator
        - skilled
        - expert
        - master
    
    certifications:
      type: text[]
      description: Array of certifications/qualifications
    
    # Performance
    performance_rating:
      type: decimal
      description: Latest performance review score (1-5)
      constraints:
        - check: performance_rating BETWEEN 1 AND 5
    
    last_review_date:
      type: date
      description: Date of last performance review
    
    # Attendance
    pto_balance_hours:
      type: decimal
      description: Paid time off balance
      constraints:
        - default: 0
        - check: pto_balance_hours >= 0
    
    sick_leave_hours:
      type: decimal
      description: Sick leave hours available
      constraints:
        - default: 0
        - check: sick_leave_hours >= 0
    
    # Audit Fields
    created_at:
      type: timestamp
      constraints:
        - not_null
        - default: CURRENT_TIMESTAMP
    
    updated_at:
      type: timestamp
      constraints:
        - not_null
        - default: CURRENT_TIMESTAMP
    
    created_by:
      type: uuid
      constraints:
        - foreign_key: users.id
    
    updated_by:
      type: uuid
      constraints:
        - foreign_key: users.id

  indexes:
    - name: idx_employees_tenant
      columns: [tenant_id]
      type: btree
    
    - name: idx_employees_employee_number
      columns: [employee_number]
      type: btree
      unique: true
    
    - name: idx_employees_status
      columns: [tenant_id, employment_status]
      type: btree
    
    - name: idx_employees_department
      columns: [tenant_id, department, employment_status]
      type: btree
    
    - name: idx_employees_manager
      columns: [manager_id]
      type: btree
    
    - name: idx_employees_hire_date
      columns: [tenant_id, hire_date]
      type: btree
      description: For tenure analysis

  kpisEnabled:
    critical:
      - total_headcount
      - employee_turnover_rate
      - revenue_per_employee
    
    high:
      - average_tenure
      - termination_rate
      - voluntary_vs_involuntary_turnover
      - fte_count
      - labor_capacity_hours
      - absenteeism_rate
    
    medium:
      - time_to_fill_position (with hiring data)
      - employee_productivity
      - training_hours_per_employee

  relatedEntities:
    - labor-tracking.yaml
    - user.yaml (for system access)

  migrationNotes: |
    Medium priority for Phase 7 - needed for HR KPIs.
    
    Migration Considerations:
    - PII data - requires encryption at rest
    - GDPR/CCPA compliance considerations
    - Integration with HR/payroll systems
    - Audit trail for compensation changes
    - Soft delete (don't hard delete terminated employees)
    
    Data Population:
    - Import from existing HR system
    - Manual entry for new hires
    - Integration with payroll provider
    
    Blue-Green Deployment:
    - New table, safe to add
    - Self-referential foreign key (manager_id) requires careful data loading

