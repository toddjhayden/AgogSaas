# Database Migrations - README

## Migration Approach

This project uses **Prisma** for schema-driven database migrations.

### Why Prisma?
- Schema defined in single `schema.prisma` file
- Auto-generates migrations from schema changes
- Schema compare built-in
- TypeScript types generated from schema
- PostgreSQL native support

## Workflow

### 1. Define Schema (schema.prisma)
```prisma
model Customer {
  id        String   @id @default(dbgenerated("uuid_generate_v7()"))
  tenant_id String
  name      String
  email     String?
  
  tenant    Tenant   @relation(fields: [tenant_id], references: [id])
  
  @@index([tenant_id])
}
```

### 2. Generate Migration
```bash
# Prisma compares schema to database and generates migration
npx prisma migrate dev --name add_customer_email

# Creates: migrations/20251122_add_customer_email/migration.sql
```

### 3. Review Generated SQL
```sql
-- Auto-generated by Prisma
ALTER TABLE "customers" ADD COLUMN "email" VARCHAR(255);
```

### 4. Validate with Linter
```bash
npm run lint:migrations
```

### 5. Apply to Database
```bash
npx prisma migrate deploy
```

## Migration Files

**Location:** `migrations/`

**Format:** Prisma-generated SQL files
- `YYYYMMDDHHMMSS_description/migration.sql`

**Linter:** All migrations validated for:
- Multi-tenancy (tenant_id columns)
- Foreign key ON DELETE clauses
- Validation constraints
- Audit triggers
- Rollback scripts

## Future Setup

When database is ready:

1. Install Prisma
```bash
npm install prisma @prisma/client
npx prisma init
```

2. Configure connection (`.env`)
```
DATABASE_URL="postgresql://user:password@localhost:5432/agog"
```

3. Define initial schema (`schema.prisma`)

4. Create baseline migration
```bash
npx prisma migrate dev --name initial_schema
```

## Documentation

- [Migration Standards](../../../Standards/data/migration-standards.md)
- [Database Standards](../../../Standards/data/database-standards.md)
- [Prisma Documentation](https://www.prisma.io/docs)

---

**Note:** Migration files will be created here once database project begins. Example migrations have been removed - real migrations will be Prisma-generated.
