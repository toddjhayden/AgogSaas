version: '0.1'
metadata:
  domain: financial
  category: Cash Flow & Liquidity
  total_kpis: 10

kpis:
  - id: cash_burn_rate
    name: Cash Burn Rate
    description: Rate at which cash reserves are being depleted
    formula: "(Beginning Cash Balance - Ending Cash Balance) / Number of Months"
    unit: currency_per_month
    target: "< Monthly Revenue"
    priority: critical
    validation_status: cannot_calculate
    required_schemas:
      - cash-flow.yaml
    required_entities:
      - CashFlow
    required_fields:
      - opening_balance
      - closing_balance
      - period
      - period_type
    calculation_notes: |
      Critical for startups and growth companies.
      Negative burn rate means cash is increasing (good).

  - id: cash_reserves_in_days
    name: Cash Reserves in Days (Runway)
    description: Number of days current cash will last at current burn rate
    formula: "Current Cash Balance / Average Daily Cash Burn"
    unit: days
    target: ">= 90 days"
    priority: critical
    validation_status: cannot_calculate
    required_schemas:
      - cash-flow.yaml
    required_entities:
      - CashFlow
    required_fields:
      - closing_balance
      - net_cash_flow
      - period_type
    calculation_notes: |
      Also called "runway" - how long until cash runs out.
      < 30 days: Emergency
      30-90 days: Concerning
      > 180 days: Comfortable

  - id: days_sales_outstanding
    name: Days Sales Outstanding (DSO)
    description: Average days to collect payment from customers
    formula: "(Accounts Receivable / Total Revenue) × Number of Days in Period"
    unit: days
    target: "<= 45 days"
    priority: critical
    validation_status: cannot_calculate
    required_schemas:
      - accounts-receivable.yaml
      - financial-statement.yaml
    required_entities:
      - AccountsReceivable
      - FinancialStatement
    required_fields:
      - amount_outstanding
      - total_revenue
      - period
    calculation_notes: |
      Lower is better - faster cash collection.
      Compare to payment terms (Net 30, Net 45, etc.).

  - id: days_payables_outstanding
    name: Days Payables Outstanding (DPO)
    description: Average days to pay vendors
    formula: "(Accounts Payable / COGS) × Number of Days in Period"
    unit: days
    target: "30-60 days"
    priority: critical
    validation_status: cannot_calculate
    required_schemas:
      - accounts-payable.yaml
      - financial-statement.yaml
    required_entities:
      - AccountsPayable
      - FinancialStatement
    required_fields:
      - amount_outstanding
      - cost_of_goods_sold
      - period
    calculation_notes: |
      Higher is better for cash flow (but don't anger vendors).
      Balance: maximize DPO while maintaining good vendor relationships.

  - id: cash_conversion_cycle
    name: Cash Conversion Cycle (CCC)
    description: Days to convert inventory and receivables into cash
    formula: "((Accounts Receivable / Total Revenue) × Days) + ((Inventory / COGS) × Days) - ((Accounts Payable / COGS) × Days)"
    unit: days
    target: "< 60 days"
    priority: high
    validation_status: can_calculate
    required_schemas:
      - accounts-receivable.yaml
      - accounts-payable.yaml
      - financial-statement.yaml
    required_entities:
      - AccountsReceivable
      - AccountsPayable
      - FinancialStatement
    required_fields:
      - amount_outstanding
      - total_revenue
      - cost_of_goods_sold
      - period
    calculation_notes: |
      Measures working capital efficiency.
      CCC = DSO + DIO - DPO (broken down into component calculations)
      Lower is better - less cash tied up in operations.
      Negative CCC means vendors finance your working capital (rare but excellent).

      Component formulas:
      - DSO (Days Sales Outstanding) = (SUM(AR.amount_outstanding) / FS.total_revenue) × Days
      - DIO (Days Inventory Outstanding) = (SUM(MI.total_cost) / FS.cost_of_goods_sold) × Days
      - DPO (Days Payables Outstanding) = (SUM(AP.amount_outstanding) / FS.cost_of_goods_sold) × Days

      Inventory value from material_inventory table (separate query, not in required_fields)

  - id: operating_cash_flow
    name: Operating Cash Flow (OCF)
    description: Cash generated from core business operations
    formula: "Net Income + Non-Cash Expenses + Changes in Working Capital"
    unit: currency
    target: "Positive and growing"
    priority: critical
    validation_status: cannot_calculate
    required_schemas:
      - cash-flow.yaml
      - financial-statement.yaml
    required_entities:
      - CashFlow
      - FinancialStatement
    required_fields:
      - cash_inflows_operations
      - cash_outflows_operations
      - operating_cash_flow
    calculation_notes: |
      Most important cash flow metric.
      Company can be profitable but have negative OCF (danger sign).

  - id: free_cash_flow
    name: Free Cash Flow (FCF)
    description: Cash available after capital expenditures
    formula: "Operating Cash Flow - Capital Expenditures"
    unit: currency
    target: "Positive"
    priority: critical
    validation_status: cannot_calculate
    required_schemas:
      - cash-flow.yaml
    required_entities:
      - CashFlow
    required_fields:
      - cash_inflows_operations
      - cash_outflows_operations
      - cash_outflows_capex
    calculation_notes: |
      Shows true cash generation ability.
      FCF funds dividends, debt repayment, growth initiatives.

  - id: average_days_delinquent
    name: Average Days Delinquent
    description: Average days invoices are overdue
    formula: "SUM(Days Overdue) / COUNT(Overdue Invoices)"
    unit: days
    target: "<= 15 days"
    priority: high
    validation_status: cannot_calculate
    required_schemas:
      - accounts-receivable.yaml
    required_entities:
      - AccountsReceivable
    required_fields:
      - days_overdue
      - is_overdue
      - status
    calculation_notes: |
      Only counts invoices past due date.
      High value indicates collection problems.

  - id: overdues_ratio
    name: Overdues Ratio
    description: Overdue AR as percentage of total AR
    formula: "(Overdue AR Amount / Total AR Amount) × 100"
    unit: percentage
    target: "<= 20%"
    priority: high
    validation_status: cannot_calculate
    required_schemas:
      - accounts-receivable.yaml
    required_entities:
      - AccountsReceivable
    required_fields:
      - amount_outstanding
      - is_overdue
      - aging_bucket
    calculation_notes: |
      Break down by aging bucket: 30-60, 60-90, 90+ days.
      High ratio indicates credit policy or collection issues.

  - id: cash_flow_adequacy_ratio
    name: Cash Flow Adequacy Ratio
    description: Operating cash flow divided by average annual debt repayment
    formula: "Operating Cash Flow / (Debt Principal Payments + Dividends + Capital Expenditures)"
    unit: ratio
    target: ">= 1.0"
    priority: medium
    validation_status: cannot_calculate
    required_schemas:
      - cash-flow.yaml
      - financial-statement.yaml
    required_entities:
      - CashFlow
      - FinancialStatement
    required_fields:
      - operating_cash_flow
      - cash_outflows_debt
      - cash_outflows_capex
    calculation_notes: |
      > 1.0: Company generates enough cash to meet obligations
      < 1.0: May need external financing

related_schemas:
  - cash-flow.yaml
  - accounts-receivable.yaml
  - accounts-payable.yaml
  - financial-statement.yaml

notes: |
  Cash is king - profitability doesn't matter if you run out of cash.
  DSO, DPO, and CCC form the "working capital triad" - optimize together.
  Burn rate and runway are critical for growth companies and startups.
  OCF > Net Income is a sign of quality earnings.
  FCF is what investors really care about - cash you can use for returns.
