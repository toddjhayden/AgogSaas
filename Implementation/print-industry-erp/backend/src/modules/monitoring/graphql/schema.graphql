"""
System Monitoring and Operational Dashboard GraphQL Schema
Provides real-time system health, error tracking, and agent activity monitoring
"""

scalar DateTime
scalar JSON

# ============================================
# System Health Types
# ============================================

enum HealthStatus {
  OPERATIONAL
  DEGRADED
  DOWN
  UNKNOWN
}

type ComponentHealth {
  """Component name (backend, frontend, database, nats)"""
  name: String!

  """Current health status"""
  status: HealthStatus!

  """Last successful check timestamp"""
  lastCheck: DateTime!

  """Response time in milliseconds"""
  responseTime: Int

  """Error message if component is down"""
  error: String

  """Additional metadata"""
  metadata: JSON
}

type SystemHealth {
  """Overall system health"""
  overall: HealthStatus!

  """Individual component health"""
  backend: ComponentHealth!
  frontend: ComponentHealth!
  database: ComponentHealth!
  nats: ComponentHealth!

  """Timestamp of health check"""
  timestamp: DateTime!
}

# ============================================
# Error Tracking Types
# ============================================

enum ErrorSeverity {
  CRITICAL
  ERROR
  WARNING
  INFO
}

enum ErrorStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  IGNORED
}

type SystemError {
  """Unique error identifier"""
  id: ID!

  """Error severity level"""
  severity: ErrorSeverity!

  """Current status"""
  status: ErrorStatus!

  """Error message"""
  message: String!

  """Stack trace if available"""
  stackTrace: String

  """Component where error occurred"""
  component: String!

  """User or session affected"""
  userId: String
  tenantId: String

  """Occurrence tracking"""
  firstOccurred: DateTime!
  lastOccurred: DateTime!
  occurrenceCount: Int!

  """Resolution tracking"""
  assignedTo: String
  resolvedBy: String
  resolvedAt: DateTime
  resolutionNotes: String

  """Additional context"""
  metadata: JSON
}

# ============================================
# Agent Activity Types
# ============================================

enum AgentStatus {
  IDLE
  RUNNING
  BLOCKED
  COMPLETED
  FAILED
}

type AgentActivity {
  """Agent identifier"""
  agentId: String!

  """Agent name (cynthia, sylvia, roy, jen, etc.)"""
  agentName: String!

  """Current status"""
  status: AgentStatus!

  """Feature request number being worked on"""
  reqNumber: String

  """Feature title"""
  featureTitle: String

  """Current stage/task"""
  currentTask: String

  """Progress percentage (0-100)"""
  progress: Int!

  """Start timestamp"""
  startedAt: DateTime

  """Estimated completion time"""
  estimatedCompletion: DateTime

  """Deliverable path if available"""
  deliverablePath: String

  """Error message if failed"""
  error: String

  """Additional metadata"""
  metadata: JSON
}

# ============================================
# Active Fixes Types (from OWNER_REQUESTS.md)
# ============================================

enum FixPriority {
  CRITICAL
  HIGH
  MEDIUM
  LOW
}

enum FixStatus {
  REQUESTED
  IN_PROGRESS
  BLOCKED
  COMPLETE
  CANCELLED
}

type ActiveFix {
  """Request number (REQ-XXX)"""
  reqNumber: String!

  """Request title"""
  title: String!

  """Priority level"""
  priority: FixPriority!

  """Current status"""
  status: FixStatus!

  """Owner assigned (marcus, sarah, alex)"""
  owner: String!

  """Request timestamp"""
  requestedAt: DateTime!

  """Estimated completion"""
  estimatedCompletion: DateTime

  """Description"""
  description: String

  """Blocking issues"""
  blockers: [String!]

  """Progress notes"""
  notes: String

  """Related agent activities"""
  agentActivities: [AgentActivity!]
}

# ============================================
# Workflow Orchestration Types
# ============================================

enum WorkflowStatus {
  PENDING
  RUNNING
  BLOCKED
  COMPLETE
  FAILED
}

type WorkflowStage {
  """Stage name"""
  name: String!

  """Agent responsible"""
  agent: String!

  """Stage status"""
  status: AgentStatus!

  """Start timestamp"""
  startedAt: DateTime

  """Completion timestamp"""
  completedAt: DateTime

  """Duration in seconds"""
  duration: Int
}

type FeatureWorkflow {
  """Request number"""
  reqNumber: String!

  """Feature title"""
  title: String!

  """Assigned owner"""
  assignedTo: String!

  """Overall workflow status"""
  status: WorkflowStatus!

  """Workflow stages"""
  stages: [WorkflowStage!]!

  """Current stage index"""
  currentStage: Int!

  """Start timestamp"""
  startedAt: DateTime!

  """Completion timestamp"""
  completedAt: DateTime

  """Total duration in hours"""
  totalDuration: Float
}

# ============================================
# Queries
# ============================================

type Query {
  """Get current system health"""
  systemHealth: SystemHealth!

  """Get component health history"""
  healthHistory(
    component: String
    startTime: DateTime!
    endTime: DateTime!
  ): [ComponentHealth!]!

  """Get system errors"""
  systemErrors(
    severity: ErrorSeverity
    status: ErrorStatus
    component: String
    limit: Int = 50
    offset: Int = 0
  ): [SystemError!]!

  """Get error by ID"""
  systemError(id: ID!): SystemError

  """Get active agent activities"""
  agentActivities: [AgentActivity!]!

  """Get agent activity by agent ID"""
  agentActivity(agentId: String!): AgentActivity

  """Get active fixes from OWNER_REQUESTS.md"""
  activeFixes(
    owner: String
    status: FixStatus
    priority: FixPriority
  ): [ActiveFix!]!

  """Get fix by request number"""
  activeFix(reqNumber: String!): ActiveFix

  """Get feature workflows"""
  featureWorkflows(
    status: WorkflowStatus
    assignedTo: String
  ): [FeatureWorkflow!]!

  """Get workflow by request number"""
  featureWorkflow(reqNumber: String!): FeatureWorkflow

  """Get monitoring statistics"""
  monitoringStats: MonitoringStats!
}

type MonitoringStats {
  """Total open errors"""
  openErrors: Int!

  """Critical errors in last 24h"""
  criticalErrors24h: Int!

  """Active agent count"""
  activeAgents: Int!

  """Average workflow duration (hours)"""
  avgWorkflowDuration: Float!

  """System uptime percentage"""
  uptimePercentage: Float!

  """Total completed workflows"""
  completedWorkflows: Int!
}

# ============================================
# Mutations
# ============================================

type Mutation {
  """Update error status"""
  updateErrorStatus(
    id: ID!
    status: ErrorStatus!
    assignedTo: String
    resolutionNotes: String
  ): SystemError!

  """Mark error as resolved"""
  resolveError(
    id: ID!
    resolvedBy: String!
    resolutionNotes: String!
  ): SystemError!

  """Create manual error entry"""
  createError(
    severity: ErrorSeverity!
    message: String!
    component: String!
    stackTrace: String
    userId: String
    tenantId: String
    metadata: JSON
  ): SystemError!
}

# ============================================
# Subscriptions (Real-time Updates)
# ============================================

type Subscription {
  """Subscribe to system health updates"""
  systemHealthUpdated: SystemHealth!

  """Subscribe to new errors"""
  errorCreated(severity: ErrorSeverity): SystemError!

  """Subscribe to error status changes"""
  errorUpdated(id: ID): SystemError!

  """Subscribe to agent activity updates"""
  agentActivityUpdated(agentId: String): AgentActivity!

  """Subscribe to workflow updates"""
  workflowUpdated(reqNumber: String): FeatureWorkflow!
}
