# ============================================
# SUPPLIER PORTAL SCHEMA
# ============================================
# REQ: REQ-STRATEGIC-AUTO-1767116143666 - Supply Chain Visibility & Supplier Portal
# Purpose: GraphQL schema for supplier portal queries and mutations
# Security: All queries require supplier authentication and RLS enforcement

# ============================================
# QUERIES
# ============================================

type Query {
  """
  Get supplier dashboard metrics and recent activity
  """
  supplierDashboard: SupplierDashboard!

  """
  Get list of purchase orders for authenticated supplier
  Supports filtering by status, date range, and pagination
  """
  supplierPurchaseOrders(
    status: [PurchaseOrderStatus!]
    fromDate: Date
    toDate: Date
    limit: Int = 50
    offset: Int = 0
  ): SupplierPurchaseOrderConnection!

  """
  Get detailed information about a specific purchase order
  """
  supplierPurchaseOrder(poNumber: String!): SupplierPurchaseOrder!

  """
  Get list of Advanced Ship Notices (ASNs) created by supplier
  """
  supplierASNs(
    status: [ASNStatus!]
    limit: Int = 50
    offset: Int = 0
  ): SupplierASNConnection!

  """
  Get detailed information about a specific ASN
  """
  supplierASN(asnNumber: String!): AdvancedShipNotice!

  """
  Get supplier performance scorecard for specific period
  """
  supplierPerformance(
    year: Int!
    month: Int
  ): SupplierPerformanceScorecard!

  """
  Get supplier performance trends over time
  """
  supplierPerformanceTrends(
    months: Int = 12
  ): [SupplierPerformanceMonth!]!

  """
  Get active alerts for supplier
  """
  supplierAlerts(
    status: [AlertStatus!] = [ACTIVE]
    limit: Int = 20
  ): [SupplierAlert!]!

  """
  Get supplier documents (uploaded files)
  """
  supplierDocuments(
    documentType: SupplierDocumentType
    limit: Int = 50
    offset: Int = 0
  ): SupplierDocumentConnection!
}

# ============================================
# MUTATIONS
# ============================================

type Mutation {
  """
  Acknowledge a purchase order
  Supplier confirms receipt and provides promised delivery date
  """
  acknowledgePurchaseOrder(input: AcknowledgePOInput!): PurchaseOrderAcknowledgment!

  """
  Create an Advanced Ship Notice (ASN)
  Notifies buyer of incoming shipment
  """
  createAdvancedShipNotice(input: CreateASNInput!): AdvancedShipNotice!

  """
  Update an existing ASN
  Can update tracking number, expected delivery date, etc.
  """
  updateAdvancedShipNotice(
    asnNumber: String!
    input: UpdateASNInput!
  ): AdvancedShipNotice!

  """
  Upload a document (packing slip, invoice, certificate, etc.)
  """
  uploadSupplierDocument(input: UpplierDocumentInput!): SupplierDocument!

  """
  Update supplier contact information
  """
  updateSupplierContact(input: UpdateSupplierContactInput!): SupplierUser!
}

# ============================================
# TYPES - Dashboard
# ============================================

type SupplierDashboard {
  """Summary metrics"""
  openPOCount: Int!
  openPOTotalValue: Decimal!
  pendingASNCount: Int!
  pendingShipmentCount: Int!

  """Performance"""
  currentPerformanceRating: Decimal
  onTimeDeliveryPercentage: Decimal
  qualityAcceptancePercentage: Decimal
  vendorTier: VendorTier!

  """Recent activity"""
  recentAlerts: [SupplierAlert!]!
  recentActivity: [SupplierActivity!]!
  recentPurchaseOrders: [SupplierPurchaseOrderSummary!]!
}

type SupplierActivity {
  id: ID!
  activityType: String!
  activityDetails: JSON
  createdAt: DateTime!
}

# ============================================
# TYPES - Purchase Orders
# ============================================

type SupplierPurchaseOrderConnection {
  nodes: [SupplierPurchaseOrderSummary!]!
  totalCount: Int!
  pageInfo: PageInfo!
}

type SupplierPurchaseOrderSummary {
  id: ID!
  poNumber: String!
  poDate: Date!
  requestedDeliveryDate: Date
  status: PurchaseOrderStatus!
  totalAmount: Decimal!
  currency: String!
  lineCount: Int!
  isAcknowledged: Boolean!
  hasASN: Boolean!
}

type SupplierPurchaseOrder {
  id: ID!
  poNumber: String!
  poDate: Date!
  requestedDeliveryDate: Date
  promisedDeliveryDate: Date
  status: PurchaseOrderStatus!

  """Buyer information"""
  buyerName: String
  buyerEmail: String
  buyerPhone: String
  buyerNotes: String

  """Shipping information"""
  shipToFacility: Facility!
  shipToAddress: Address!
  shippingMethod: String

  """Line items"""
  lines: [SupplierPurchaseOrderLine!]!

  """Financial"""
  subtotal: Decimal!
  taxAmount: Decimal!
  shippingAmount: Decimal!
  totalAmount: Decimal!
  currency: String!

  """Acknowledgment"""
  acknowledgment: PurchaseOrderAcknowledgment
  acknowledgedAt: DateTime
  acknowledgedByUser: String
  acknowledgmentNotes: String

  """ASN"""
  asns: [AdvancedShipNotice!]!

  """Audit"""
  createdAt: DateTime!
  updatedAt: DateTime
}

type SupplierPurchaseOrderLine {
  id: ID!
  lineNumber: Int!
  materialId: ID
  sku: String
  description: String!
  quantity: Decimal!
  unitPrice: Decimal!
  unitOfMeasure: String
  extendedPrice: Decimal!
  requestedDate: Date
  promisedDate: Date
  quantityReceived: Decimal
  quantityRemaining: Decimal
}

type Facility {
  id: ID!
  facilityCode: String!
  facilityName: String!
  address: Address!
}

type Address {
  address1: String!
  address2: String
  city: String!
  state: String!
  postalCode: String!
  country: String!
}

type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  totalPages: Int!
}

# ============================================
# TYPES - PO Acknowledgment
# ============================================

type PurchaseOrderAcknowledgment {
  id: ID!
  purchaseOrderId: ID!
  poNumber: String!
  acknowledgedAt: DateTime!
  acknowledgedByUser: SupplierUser!
  promisedDeliveryDate: Date
  expectedLeadTimeDays: Int
  acknowledgmentStatus: POAcknowledgmentStatus!
  acknowledgmentNotes: String
  proposedChanges: [POProposedChange!]
}

type POProposedChange {
  lineNumber: Int!
  field: String!
  oldValue: String
  newValue: String!
  reason: String
}

type SupplierUser {
  id: ID!
  email: String!
  firstName: String!
  lastName: String!
  role: SupplierUserRole!
  jobTitle: String
}

# ============================================
# TYPES - Advanced Ship Notice (ASN)
# ============================================

type SupplierASNConnection {
  nodes: [AdvancedShipNotice!]!
  totalCount: Int!
  pageInfo: PageInfo!
}

type AdvancedShipNotice {
  id: ID!
  asnNumber: String!
  purchaseOrderId: ID!
  poNumber: String!

  """Shipment details"""
  carrierCode: String!
  carrierService: String
  trackingNumber: String
  proNumber: String
  expectedDeliveryDate: Date!
  actualShipDate: Date!
  estimatedArrivalDate: Date

  """Package details"""
  packageCount: Int!
  totalWeight: Decimal
  weightUnit: String!
  totalVolume: Decimal
  volumeUnit: String

  """Addresses"""
  shipFromAddress: Address!
  shipToAddress: Address!

  """Line items"""
  lines: [ASNLine!]!

  """Documents"""
  packingSlipUrl: String
  billOfLadingUrl: String
  commercialInvoiceUrl: String
  otherDocuments: [ASNDocument!]

  """Status"""
  status: ASNStatus!
  createdAt: DateTime!
  updatedAt: DateTime
  submittedAt: DateTime
  createdByUser: SupplierUser!

  """Receiving information"""
  receivedAt: DateTime
  receivedByUser: String
  receivingNotes: String
  receivingDiscrepancies: [ReceivingDiscrepancy!]
}

type ASNLine {
  id: ID!
  poLineId: ID!
  lineNumber: Int!
  materialId: ID
  sku: String
  description: String!
  quantityShipped: Decimal!
  quantityOrdered: Decimal
  unitOfMeasure: String
  lotNumber: String
  serialNumbers: [String!]
  expirationDate: Date
  packageNumber: Int
  weight: Decimal
  weightUnit: String
  quantityReceived: Decimal
  quantityRejected: Decimal
  rejectionReason: String
}

type ASNDocument {
  type: String!
  url: String!
  filename: String!
}

type ReceivingDiscrepancy {
  lineId: ID!
  lineNumber: Int!
  expectedQuantity: Decimal!
  actualQuantity: Decimal!
  variance: Decimal!
  reason: String!
}

# ============================================
# TYPES - Performance
# ============================================

type SupplierPerformanceScorecard {
  vendorId: ID!
  vendorName: String!
  vendorCode: String!
  year: Int!
  month: Int!

  """Metrics"""
  totalPOsIssued: Int!
  totalPOsValue: Decimal!
  onTimeDeliveryPercentage: Decimal!
  qualityAcceptancePercentage: Decimal!
  overallRating: Decimal!
  averageLeadTimeDays: Int

  """Tier"""
  vendorTier: VendorTier!

  """Trends"""
  onTimeDeliveryTrend: Trend!
  qualityTrend: Trend!

  """Period comparison"""
  previousMonthComparison: PerformanceComparison
}

type SupplierPerformanceMonth {
  year: Int!
  month: Int!
  onTimeDeliveryPercentage: Decimal!
  qualityAcceptancePercentage: Decimal!
  overallRating: Decimal!
  totalPOsIssued: Int!
}

type PerformanceComparison {
  onTimeDeliveryChange: Decimal!
  qualityChange: Decimal!
  ratingChange: Decimal!
}

# ============================================
# TYPES - Alerts
# ============================================

type SupplierAlert {
  id: ID!
  alertType: AlertType!
  alertCategory: AlertCategory!
  message: String!
  status: AlertStatus!
  createdAt: DateTime!
  acknowledgedAt: DateTime
  resolvedAt: DateTime
  metricValue: Decimal
  thresholdValue: Decimal
  actionItems: [String!]
}

# ============================================
# TYPES - Documents
# ============================================

type SupplierDocumentConnection {
  nodes: [SupplierDocument!]!
  totalCount: Int!
  pageInfo: PageInfo!
}

type SupplierDocument {
  id: ID!
  documentType: SupplierDocumentType!
  documentCategory: String
  fileName: String!
  fileSizeBytes: Int!
  mimeType: String
  storageUrl: String!
  title: String
  description: String
  documentNumber: String
  documentDate: Date
  expirationDate: Date
  virusScanStatus: VirusScanStatus!
  uploadedAt: DateTime!
  uploadedByUser: SupplierUser!
  purchaseOrder: SupplierPurchaseOrderSummary
  asn: AdvancedShipNotice
}

# ============================================
# INPUTS
# ============================================

input AcknowledgePOInput {
  poNumber: String!
  promisedDeliveryDate: Date
  expectedLeadTimeDays: Int
  acknowledgmentStatus: POAcknowledgmentStatus!
  acknowledgmentNotes: String
  proposedChanges: [POProposedChangeInput!]
}

input POProposedChangeInput {
  lineNumber: Int!
  field: String!
  oldValue: String
  newValue: String!
  reason: String!
}

input CreateASNInput {
  poNumber: String!
  carrierCode: String!
  carrierService: String
  trackingNumber: String
  proNumber: String
  expectedDeliveryDate: Date!
  actualShipDate: Date!
  packageCount: Int!
  totalWeight: Decimal
  weightUnit: String
  totalVolume: Decimal
  volumeUnit: String
  lines: [CreateASNLineInput!]!
  packingSlipUrl: String
  billOfLadingUrl: String
  commercialInvoiceUrl: String
}

input CreateASNLineInput {
  poLineId: ID!
  quantityShipped: Decimal!
  lotNumber: String
  serialNumbers: [String!]
  expirationDate: Date
  packageNumber: Int
  weight: Decimal
  weightUnit: String
}

input UpdateASNInput {
  carrierService: String
  trackingNumber: String
  proNumber: String
  expectedDeliveryDate: Date
  estimatedArrivalDate: Date
  packingSlipUrl: String
  billOfLadingUrl: String
  commercialInvoiceUrl: String
}

input UpplierDocumentInput {
  documentType: SupplierDocumentType!
  fileName: String!
  fileSizeBytes: Int!
  mimeType: String!
  storageUrl: String!
  title: String
  description: String
  documentNumber: String
  documentDate: Date
  expirationDate: Date
  purchaseOrderId: ID
  asnId: ID
}

input UpdateSupplierContactInput {
  firstName: String
  lastName: String
  phone: String
  jobTitle: String
  preferredLanguage: String
  timezone: String
  notificationPreferences: JSON
}

# ============================================
# ENUMS
# ============================================

enum PurchaseOrderStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  SENT_TO_VENDOR
  ACKNOWLEDGED
  IN_TRANSIT
  PARTIALLY_RECEIVED
  RECEIVED
  CLOSED
  CANCELLED
}

enum POAcknowledgmentStatus {
  ACCEPTED
  PARTIAL
  BACKORDERED
  REJECTED
  PRICE_CHANGE
}

enum ASNStatus {
  CREATED
  SUBMITTED
  IN_TRANSIT
  RECEIVED
  CLOSED
  CANCELLED
}

enum SupplierUserRole {
  VENDOR_ADMIN
  VENDOR_USER
  VENDOR_VIEWER
}

enum VendorTier {
  STRATEGIC
  PREFERRED
  TRANSACTIONAL
}

enum AlertType {
  CRITICAL
  WARNING
  TREND
}

enum AlertCategory {
  OTD          # On-Time Delivery
  QUALITY
  RATING
  COMPLIANCE
}

enum AlertStatus {
  ACTIVE
  ACKNOWLEDGED
  RESOLVED
  DISMISSED
}

enum Trend {
  IMPROVING
  STABLE
  DECLINING
}

enum SupplierDocumentType {
  PACKING_SLIP
  BILL_OF_LADING
  INVOICE
  CERTIFICATE
  ISO_CERT
  FDA_CERT
  FSC_CERT
  SDS              # Safety Data Sheet
  OTHER
}

enum VirusScanStatus {
  PENDING
  SCANNING
  CLEAN
  INFECTED
  SCAN_ERROR
}

# ============================================
# SCALARS
# ============================================

scalar Date
scalar DateTime
scalar Decimal
scalar JSON
