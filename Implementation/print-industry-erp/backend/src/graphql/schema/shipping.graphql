# =====================================================
# SHIPPING & CARRIER INTEGRATION SCHEMA
# =====================================================
# REQ-1767925582663-ieqg0: FedEx Carrier Integration & Multi-Carrier Network
# Purpose: GraphQL schema for carrier integrations, shipments, and tracking
# =====================================================

# =====================================================
# ENUMS
# =====================================================

enum CarrierCode {
  FEDEX
  UPS
  USPS
  DHL
  CUSTOM
}

enum CarrierType {
  PARCEL
  LTL
  FTL
  COURIER
  THREE_PL
  FREIGHT_FORWARDER
}

enum ShipmentStatus {
  DRAFT
  READY_TO_SHIP
  MANIFESTED
  SHIPPED
  IN_TRANSIT
  OUT_FOR_DELIVERY
  DELIVERED
  EXCEPTION
  CANCELLED
  RETURNED
}

enum TrackingStatus {
  LABEL_CREATED
  PICKED_UP
  IN_TRANSIT
  OUT_FOR_DELIVERY
  DELIVERED
  EXCEPTION
  RETURNED
  CANCELLED
}

enum LabelFormat {
  PDF
  PNG
  ZPL
}

enum ConnectionStatus {
  CONNECTED
  DISCONNECTED
  ERROR
  PENDING
}

# =====================================================
# CARRIER INTEGRATION TYPES
# =====================================================

type CarrierIntegration {
  id: ID!
  tenantId: ID!
  facilityId: ID!

  # Carrier identification
  carrierCode: CarrierCode!
  carrierName: String!
  carrierType: CarrierType!

  # API configuration
  apiEndpoint: String
  apiVersion: String
  accountNumber: String

  # Service capabilities
  serviceMapping: [CarrierService!]
  credentialsConfigured: Boolean!
  supportsTracking: Boolean!
  supportsRateQuotes: Boolean!
  supportsLabelGeneration: Boolean!

  # Status
  isActive: Boolean!
  connectionStatus: ConnectionStatus
  lastConnectionTest: DateTime

  # Audit
  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

type CarrierService {
  code: String!
  name: String!
  transitDays: Int
  guaranteedDelivery: Boolean!
}

type ConnectionTestResult {
  isConnected: Boolean!
  apiVersion: String
  responseTimeMs: Int
  error: String
  testedAt: DateTime!
}

# =====================================================
# SHIPMENT TYPES
# =====================================================

type Shipment {
  id: ID!
  tenantId: ID!
  facilityId: ID!

  # Identification
  shipmentNumber: String!
  salesOrderId: ID
  waveId: ID

  # Carrier
  carrierIntegrationId: ID
  carrier: CarrierIntegration
  carrierName: String
  serviceLevel: String
  trackingNumber: String
  proNumber: String

  # Customer/destination
  customerId: ID!
  shipToName: String!
  shipToAddressLine1: String!
  shipToAddressLine2: String
  shipToCity: String!
  shipToState: String
  shipToPostalCode: String!
  shipToCountry: String!
  shipToPhone: String
  shipToEmail: String

  # Timing
  shipmentDate: Date
  estimatedDeliveryDate: Date
  actualDeliveryDate: Date

  # Package details
  numberOfPackages: Int!
  totalWeight: Float
  totalVolume: Float

  # Costs
  freight: Float
  insurance: Float
  otherCharges: Float
  totalCost: Float
  currency: String

  # Documents
  bolNumber: String
  bolDocument: String
  commercialInvoice: String
  labelUrl: String

  # Status
  status: ShipmentStatus!
  shippingNotes: String
  deliveryNotes: String

  # Relations
  lines: [ShipmentLine!]
  trackingEvents: [TrackingEvent!]

  # Audit
  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

type ShipmentLine {
  id: ID!
  shipmentId: ID!
  lineNumber: Int!

  # Material
  salesOrderLineId: ID
  materialId: ID!
  materialCode: String!
  materialDescription: String

  # Quantity
  quantityShipped: Float!
  unitOfMeasure: String!

  # Package
  packageNumber: Int
  weight: Float
  volume: Float

  # Traceability
  lotNumber: String
  serialNumbers: [String!]
}

type TrackingEvent {
  id: ID!
  shipmentId: ID!
  trackingNumber: String!

  # Event details
  eventDate: DateTime!
  eventType: TrackingStatus!
  eventDescription: String!

  # Location
  city: String
  state: String
  country: String
  postalCode: String

  # Carrier details
  carrierEventCode: String
  exceptionFlag: Boolean
  exceptionReason: String
  signedBy: String

  # Audit
  createdAt: DateTime!
}

# =====================================================
# RATE QUOTE TYPES
# =====================================================

type RateQuote {
  serviceType: String!
  serviceName: String!
  carrierCode: CarrierCode!
  carrierName: String!

  # Cost
  totalCost: Float!
  currency: String!

  # Breakdown
  baseRate: Float
  fuelSurcharge: Float
  insurance: Float
  residential: Float
  saturday: Float
  otherCharges: Float

  # Transit
  transitDays: Int
  estimatedDeliveryDate: Date
  guaranteedDelivery: Boolean!

  # Metadata
  quotedAt: DateTime!
}

# =====================================================
# MANIFEST TYPES
# =====================================================

type ManifestConfirmation {
  manifestId: String!
  carrierManifestId: String!
  manifestDate: Date!
  shipmentCount: Int!
  totalWeight: Float
  documentUrl: String
}

# =====================================================
# INPUT TYPES
# =====================================================

input CreateCarrierIntegrationInput {
  facilityId: ID!
  carrierCode: CarrierCode!
  carrierName: String!
  carrierType: CarrierType!

  # API configuration
  apiEndpoint: String
  apiVersion: String
  accountNumber: String!
  billingAccountNumber: String

  # Credentials
  apiUsername: String
  apiPassword: String
  apiKey: String
  oauthToken: String

  # Service mapping
  serviceMapping: [CarrierServiceInput!]
  defaultServiceCode: String
  labelFormat: LabelFormat

  isActive: Boolean
}

input UpdateCarrierIntegrationInput {
  carrierName: String
  apiEndpoint: String
  apiVersion: String
  accountNumber: String

  # Credentials (optional update)
  apiUsername: String
  apiPassword: String
  apiKey: String
  oauthToken: String

  serviceMapping: [CarrierServiceInput!]
  defaultServiceCode: String
  labelFormat: LabelFormat

  isActive: Boolean
}

input CarrierServiceInput {
  code: String!
  name: String!
  transitDays: Int
  guaranteedDelivery: Boolean!
}

input CreateShipmentInput {
  facilityId: ID!
  salesOrderId: ID

  # Carrier
  carrierIntegrationId: ID!
  serviceLevel: String!

  # Customer/destination
  customerId: ID!
  shipToName: String!
  shipToAddressLine1: String!
  shipToAddressLine2: String
  shipToCity: String!
  shipToState: String
  shipToPostalCode: String!
  shipToCountry: String!
  shipToPhone: String
  shipToEmail: String
  isResidential: Boolean

  # Package details
  packages: [ShipmentPackageInput!]!

  # Options
  insuranceValue: Float
  signatureRequired: Boolean
  saturdayDelivery: Boolean

  # Documents
  shippingNotes: String

  # Lines
  lines: [CreateShipmentLineInput!]!
}

input ShipmentPackageInput {
  sequenceNumber: Int!
  weight: Float!
  weightUnit: String!
  length: Float
  width: Float
  height: Float
  dimensionUnit: String
  insuranceValue: Float
  referenceNumbers: [String!]
}

input CreateShipmentLineInput {
  salesOrderLineId: ID
  materialId: ID!
  quantityShipped: Float!
  unitOfMeasure: String!
  packageNumber: Int
  lotNumber: String
  serialNumbers: [String!]
}

input RateShopInput {
  facilityId: ID!

  # Destination
  shipToAddressLine1: String!
  shipToCity: String!
  shipToState: String
  shipToPostalCode: String!
  shipToCountry: String!
  isResidential: Boolean

  # Packages
  packages: [ShipmentPackageInput!]!

  # Options
  insuranceValue: Float

  # Carrier filter (optional)
  carrierCodes: [CarrierCode!]
}

input ValidateAddressInput {
  addressLine1: String!
  addressLine2: String
  city: String!
  state: String
  postalCode: String!
  country: String!
}

# =====================================================
# ADDRESS VALIDATION TYPES
# =====================================================

type AddressValidationResult {
  isValid: Boolean!
  validatedAddress: Address
  suggestions: [Address!]
  errors: [AddressValidationError!]
}

type Address {
  name: String
  addressLine1: String!
  addressLine2: String
  city: String!
  state: String
  postalCode: String!
  country: String!
  isResidential: Boolean
}

type AddressValidationError {
  code: String!
  message: String!
  field: String!
}

# =====================================================
# QUERIES
# =====================================================

type Query {
  # Carrier integrations
  carrierIntegrations(tenantId: ID!, facilityId: ID): [CarrierIntegration!]!
  carrierIntegration(id: ID!, tenantId: ID!): CarrierIntegration

  # Test carrier connection
  testCarrierConnection(id: ID!, tenantId: ID!): ConnectionTestResult!

  # Shipments
  shipments(
    tenantId: ID!
    facilityId: ID
    status: ShipmentStatus
    startDate: Date
    endDate: Date
    trackingNumber: String
  ): [Shipment!]!

  shipment(id: ID!, tenantId: ID!): Shipment

  # Tracking
  trackingEvents(shipmentId: ID!, tenantId: ID!): [TrackingEvent!]!
  trackShipment(trackingNumber: String!, carrierCode: CarrierCode!): [TrackingEvent!]!

  # Rate shopping
  getRateQuotes(input: RateShopInput!): [RateQuote!]!

  # Address validation
  validateAddress(input: ValidateAddressInput!, carrierCode: CarrierCode): AddressValidationResult!
}

# =====================================================
# MUTATIONS
# =====================================================

type Mutation {
  # Carrier integrations
  createCarrierIntegration(input: CreateCarrierIntegrationInput!): CarrierIntegration!
  updateCarrierIntegration(id: ID!, input: UpdateCarrierIntegrationInput!): CarrierIntegration!
  deleteCarrierIntegration(id: ID!): Boolean!

  # Shipments
  createShipment(input: CreateShipmentInput!): Shipment!

  # Manifest shipment (creates label and tracking)
  manifestShipment(id: ID!): Shipment!

  # Void shipment (cancel before end-of-day)
  voidShipment(id: ID!): Boolean!

  # Update shipment status
  updateShipmentStatus(id: ID!, status: ShipmentStatus!, notes: String): Shipment!

  # End-of-day close (batch manifest)
  createManifest(shipmentIds: [ID!]!, carrierIntegrationId: ID!): ManifestConfirmation!

  # Refresh tracking
  refreshTracking(shipmentId: ID!): [TrackingEvent!]!
}

# =====================================================
# SUBSCRIPTIONS (Future enhancement)
# =====================================================

# type Subscription {
#   trackingUpdated(trackingNumber: String!): TrackingEvent!
#   shipmentStatusChanged(shipmentId: ID!): Shipment!
# }
