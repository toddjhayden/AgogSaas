# =====================================================
# QUALITY, HR, IOT, SECURITY, MARKETPLACE, IMPOSITION
# =====================================================
# Purpose: Quality management, HR/Labor, IoT, Security, Marketplace, Imposition
# Tables: 24 (quality: 5, HR: 4, IoT: 3, Security: 3, Marketplace: 4, Imposition: 5)
# =====================================================

scalar Date
scalar DateTime
scalar JSON

# =====================================================
# QUALITY MODULE
# =====================================================

type QualityStandard {
  id: ID!
  tenantId: ID!

  standardCode: String!
  standardName: String!
  standardType: String
  description: String
  requirements: JSON
  certificationBody: String

  isActive: Boolean!

  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

type InspectionTemplate {
  id: ID!
  tenantId: ID!

  templateCode: String!
  templateName: String!
  inspectionType: InspectionType!

  productId: ID
  materialId: ID
  operationId: ID

  inspectionPoints: JSON
  samplingPlan: String

  isActive: Boolean!

  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

enum InspectionType {
  INCOMING
  IN_PROCESS
  FINAL
  FIRST_ARTICLE
  RANDOM
  CUSTOMER_WITNESS
}

type QualityInspection {
  id: ID!
  tenantId: ID!
  facilityId: ID!

  inspectionNumber: String!
  inspectionDate: DateTime!
  inspectionType: InspectionType!

  inspectionTemplateId: ID

  purchaseOrderId: ID
  productionRunId: ID
  lotNumber: String

  inspectorUserId: ID!

  sampleSize: Int
  defectsFound: Int
  passFail: PassFail

  inspectionResults: JSON

  disposition: InspectionDisposition

  notes: String

  createdAt: DateTime!
  updatedAt: DateTime
}

enum PassFail {
  PASS
  FAIL
}

enum InspectionDisposition {
  ACCEPT
  REJECT
  REWORK
  USE_AS_IS
  QUARANTINE
}

type QualityDefect {
  id: ID!
  tenantId: ID!

  defectNumber: String!
  qualityInspectionId: ID
  productionRunId: ID

  defectCode: String
  defectDescription: String!
  defectSeverity: DefectSeverity

  quantityAffected: Float
  rootCause: String

  correctiveAction: String
  preventiveAction: String

  responsibleUserId: ID
  dueDate: Date
  completionDate: Date

  status: DefectStatus!

  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

enum DefectSeverity {
  CRITICAL
  MAJOR
  MINOR
}

enum DefectStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  VERIFIED
  CLOSED
}

type CustomerRejection {
  id: ID!
  tenantId: ID!

  rejectionNumber: String!
  rejectionDate: Date!
  customerId: ID!

  salesOrderId: ID
  shipmentId: ID
  invoiceId: ID

  rejectionReason: String!
  quantityRejected: Float

  disposition: RejectionDisposition

  rootCause: String
  correctiveAction: String

  responsibleUserId: ID

  status: RejectionStatus!

  financialImpact: Float

  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

enum RejectionDisposition {
  CREDIT
  REPLACEMENT
  REWORK
  SCRAP
}

enum RejectionStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

# =====================================================
# HR MODULE
# =====================================================

type Employee {
  id: ID!
  tenantId: ID!

  employeeNumber: String!
  userId: ID

  firstName: String!
  lastName: String!

  email: String
  phone: String

  jobTitle: String
  department: String
  facilityId: ID

  hireDate: Date
  terminationDate: Date

  employmentType: EmploymentType
  payType: PayType

  basePayRate: Float
  overtimePayRate: Float

  supervisorEmployeeId: ID

  isActive: Boolean!

  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
  deletedAt: DateTime
  deletedBy: ID
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  SEASONAL
}

enum PayType {
  HOURLY
  SALARY
}

type LaborRate {
  id: ID!
  tenantId: ID!

  rateCode: String!
  rateName: String!

  workCenterId: ID
  operationId: ID

  standardRatePerHour: Float!
  overtimeRatePerHour: Float

  effectiveFrom: Date!
  effectiveTo: Date

  isActive: Boolean!

  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

type Timecard {
  id: ID!
  tenantId: ID!
  facilityId: ID!

  employeeId: ID!
  timecardDate: Date!

  clockIn: DateTime
  clockOut: DateTime

  regularHours: Float
  overtimeHours: Float
  doubleTimeHours: Float

  productionRunId: ID
  workCenterId: ID

  breakHours: Float

  status: TimecardStatus!

  approvedByUserId: ID
  approvedAt: DateTime

  createdAt: DateTime!
  updatedAt: DateTime
}

enum TimecardStatus {
  PENDING
  APPROVED
  REJECTED
}

type LaborTracking {
  id: ID!
  tenantId: ID!

  employeeId: ID!
  productionRunId: ID!

  startTime: DateTime!
  endTime: DateTime

  hoursWorked: Float
  laborType: LaborType

  hourlyRate: Float
  totalLaborCost: Float

  createdAt: DateTime!
}

enum LaborType {
  SETUP
  RUN
  CLEANUP
  REWORK
}

# =====================================================
# IOT MODULE
# =====================================================

type IotDevice {
  id: ID!
  tenantId: ID!
  facilityId: ID!

  deviceCode: String!
  deviceName: String!
  deviceType: String

  workCenterId: ID

  manufacturer: String
  model: String
  serialNumber: String

  connectionType: String
  connectionConfig: JSON

  isActive: Boolean!
  lastHeartbeat: DateTime

  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

type SensorReading {
  id: ID!
  tenantId: ID!

  iotDeviceId: ID!
  readingTimestamp: DateTime!

  sensorType: String
  readingValue: Float
  unitOfMeasure: String

  productionRunId: ID

  metadata: JSON

  createdAt: DateTime!
}

type EquipmentEvent {
  id: ID!
  tenantId: ID!

  workCenterId: ID!
  iotDeviceId: ID

  eventTimestamp: DateTime!
  eventType: String!

  eventCode: String
  eventDescription: String

  severity: EventSeverity

  productionRunId: ID

  metadata: JSON

  acknowledged: Boolean!
  acknowledgedByUserId: ID
  acknowledgedAt: DateTime

  createdAt: DateTime!
}

enum EventSeverity {
  INFO
  WARNING
  ERROR
  CRITICAL
}

# =====================================================
# SECURITY MODULE
# =====================================================

type SecurityZone {
  id: ID!
  tenantId: ID!
  facilityId: ID!

  zoneCode: String!
  zoneName: String!
  zoneLevel: SecurityZoneLevel!

  description: String

  requiresBadge: Boolean!
  requiresBiometric: Boolean!
  requiresDualControl: Boolean!
  requiresEscort: Boolean!

  minimumClearanceLevel: String

  accessHours: JSON

  isActive: Boolean!

  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

enum SecurityZoneLevel {
  STANDARD
  RESTRICTED
  SECURE
  HIGH_SECURITY
  VAULT
}

type SecurityAccessLog {
  id: ID!
  tenantId: ID!

  securityZoneId: ID!
  userId: ID!

  accessTimestamp: DateTime!
  accessType: AccessType

  accessMethod: AccessMethod

  verificationUserId: ID

  granted: Boolean!
  denialReason: String

  createdAt: DateTime!
}

enum AccessType {
  ENTRY
  EXIT
}

enum AccessMethod {
  BADGE
  BIOMETRIC
  PIN
  DUAL_CONTROL
}

type ChainOfCustody {
  id: ID!
  tenantId: ID!

  itemType: String!
  itemId: ID!

  custodyTransferTimestamp: DateTime!

  fromUserId: ID
  toUserId: ID!

  fromLocationId: ID
  toLocationId: ID!

  verificationMethod: String

  witnessUserId: ID

  tamperEvidentSealId: String
  sealIntact: Boolean!

  transferReason: String
  notes: String

  createdAt: DateTime!
}

# =====================================================
# MARKETPLACE MODULE
# =====================================================

type PartnerNetworkProfile {
  id: ID!
  tenantId: ID!

  companyCode: String!
  companyName: String!
  companyType: String

  capabilities: JSON
  geographicCoverage: JSON

  reliabilityScore: Float
  onTimeDeliveryPercentage: Float
  qualityRatingPercentage: Float

  totalJobsCompleted: Int
  totalRevenueGenerated: Float

  isActive: Boolean!
  isApproved: Boolean!

  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

type MarketplaceJobPosting {
  id: ID!
  tenantId: ID!

  postingNumber: String!
  postingDate: Date!
  expirationDate: Date

  postingCompanyId: ID!

  jobDescription: String!
  quantity: Float!
  unitOfMeasure: String

  productSpecifications: JSON

  requiredDeliveryDate: Date
  requiredCertifications: JSON

  estimatedBudget: Float
  budgetCurrencyCode: String

  status: JobPostingStatus!

  awardedToCompanyId: ID
  awardedAt: DateTime

  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

enum JobPostingStatus {
  OPEN
  BIDS_RECEIVED
  AWARDED
  CANCELLED
  COMPLETED
}

type MarketplaceBid {
  id: ID!
  tenantId: ID!

  bidNumber: String!
  jobPostingId: ID!

  biddingCompanyId: ID!

  bidDate: DateTime!

  bidAmount: Float!
  bidCurrencyCode: String

  promisedDeliveryDate: Date

  capabilitiesMatch: JSON

  bidNotes: String

  status: BidStatus!

  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

enum BidStatus {
  SUBMITTED
  ACCEPTED
  REJECTED
  WITHDRAWN
}

type ExternalCompanyOrder {
  id: ID!
  tenantId: ID!

  orderNumber: String!
  orderDate: Date!

  originatingCompanyId: ID!
  fulfillingCompanyId: ID!

  jobPostingId: ID
  marketplaceBidId: ID

  orderDescription: String
  quantity: Float!

  orderAmount: Float!
  orderCurrencyCode: String

  deliveryDate: Date
  actualDeliveryDate: Date

  status: ExternalOrderStatus!

  qualityRating: Float
  onTime: Boolean

  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

enum ExternalOrderStatus {
  CONFIRMED
  IN_PRODUCTION
  SHIPPED
  DELIVERED
  INVOICED
  PAID
  CANCELLED
}

# =====================================================
# IMPOSITION MODULE
# =====================================================

type PressSpecification {
  id: ID!
  tenantId: ID!

  workCenterId: ID!

  maxSheetWidth: Float!
  maxSheetHeight: Float!
  minSheetWidth: Float!
  minSheetHeight: Float!

  gripperMargin: Float
  sideMargins: Float
  maxImageWidth: Float
  maxImageHeight: Float

  maxColors: Int
  supportsPerfecting: Boolean!

  substrateTypes: JSON

  isActive: Boolean!

  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

type SubstrateSpecification {
  id: ID!
  tenantId: ID!

  materialId: ID!

  widthInches: Float
  heightInches: Float
  caliperInches: Float
  basisWeightLbs: Int

  grainDirection: String
  finish: String

  coatingType: String
  recyclable: Boolean!
  fscCertified: Boolean!

  isActive: Boolean!

  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

type ImpositionTemplate {
  id: ID!
  tenantId: ID!

  templateCode: String!
  templateName: String!

  packagingType: String

  pressId: ID

  defaultAcross: Int
  defaultDown: Int
  defaultGutter: Float

  layoutPattern: String

  templateConfig: JSON

  isActive: Boolean!

  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

type LayoutCalculation {
  id: ID!
  tenantId: ID!

  salesOrderLineId: ID
  quoteLineId: ID

  productId: ID!
  pressId: ID!

  designWidth: Float!
  designHeight: Float!

  sheetWidth: Float!
  sheetHeight: Float!

  across: Int!
  down: Int!
  unitsPerSheet: Int!

  wastePercentage: Float

  calculationTimestamp: DateTime!
  algorithmVersion: String

  createdAt: DateTime!
}

type ImpositionMark {
  id: ID!
  tenantId: ID!

  markCode: String!
  markName: String!
  markType: String

  markPosition: String

  markSize: JSON
  markOffset: JSON

  isActive: Boolean!

  createdAt: DateTime!
  createdBy: ID
}

# =====================================================
# QUERIES
# =====================================================

type Query {
  # Quality
  qualityStandards(
    tenantId: ID!
    standardType: String
    isActive: Boolean
  ): [QualityStandard!]!

  inspectionTemplates(
    tenantId: ID!
    inspectionType: InspectionType
    productId: ID
    isActive: Boolean
  ): [InspectionTemplate!]!

  qualityInspections(
    tenantId: ID!
    facilityId: ID
    inspectionType: InspectionType
    passFail: PassFail
    startDate: DateTime
    endDate: DateTime
    limit: Int = 100
    offset: Int = 0
  ): [QualityInspection!]!

  qualityDefects(
    tenantId: ID!
    status: DefectStatus
    severity: DefectSeverity
    limit: Int = 100
    offset: Int = 0
  ): [QualityDefect!]!

  customerRejections(
    tenantId: ID!
    customerId: ID
    status: RejectionStatus
    startDate: Date
    endDate: Date
    limit: Int = 100
    offset: Int = 0
  ): [CustomerRejection!]!

  # HR
  employees(
    tenantId: ID!
    facilityId: ID
    department: String
    isActive: Boolean
    limit: Int = 100
    offset: Int = 0
  ): [Employee!]!

  employee(id: ID!): Employee

  laborRates(
    tenantId: ID!
    workCenterId: ID
    operationId: ID
    asOfDate: Date
  ): [LaborRate!]!

  timecards(
    tenantId: ID!
    employeeId: ID
    facilityId: ID
    status: TimecardStatus
    startDate: Date
    endDate: Date
    limit: Int = 100
    offset: Int = 0
  ): [Timecard!]!

  laborTracking(
    tenantId: ID!
    employeeId: ID
    productionRunId: ID
    startDate: DateTime
    endDate: DateTime
  ): [LaborTracking!]!

  # IoT
  iotDevices(
    tenantId: ID!
    facilityId: ID
    workCenterId: ID
    deviceType: String
    isActive: Boolean
  ): [IotDevice!]!

  sensorReadings(
    tenantId: ID!
    iotDeviceId: ID
    productionRunId: ID
    sensorType: String
    startTime: DateTime
    endTime: DateTime
    limit: Int = 1000
    offset: Int = 0
  ): [SensorReading!]!

  equipmentEvents(
    tenantId: ID!
    workCenterId: ID
    severity: EventSeverity
    acknowledged: Boolean
    startTime: DateTime
    endTime: DateTime
    limit: Int = 100
    offset: Int = 0
  ): [EquipmentEvent!]!

  # Security
  securityZones(
    tenantId: ID!
    facilityId: ID
    zoneLevel: SecurityZoneLevel
    isActive: Boolean
  ): [SecurityZone!]!

  securityAccessLog(
    tenantId: ID!
    securityZoneId: ID
    userId: ID
    granted: Boolean
    startTime: DateTime
    endTime: DateTime
    limit: Int = 100
    offset: Int = 0
  ): [SecurityAccessLog!]!

  chainOfCustody(
    tenantId: ID!
    itemType: String
    itemId: ID
    limit: Int = 100
    offset: Int = 0
  ): [ChainOfCustody!]!

  # Marketplace
  partnerNetworkProfiles(
    tenantId: ID!
    companyType: String
    isApproved: Boolean
    minReliabilityScore: Float
  ): [PartnerNetworkProfile!]!

  marketplaceJobPostings(
    tenantId: ID!
    postingCompanyId: ID
    status: JobPostingStatus
    startDate: Date
    endDate: Date
    limit: Int = 100
    offset: Int = 0
  ): [MarketplaceJobPosting!]!

  marketplaceBids(
    tenantId: ID!
    jobPostingId: ID
    biddingCompanyId: ID
    status: BidStatus
  ): [MarketplaceBid!]!

  externalCompanyOrders(
    tenantId: ID!
    originatingCompanyId: ID
    fulfillingCompanyId: ID
    status: ExternalOrderStatus
    limit: Int = 100
    offset: Int = 0
  ): [ExternalCompanyOrder!]!

  # Imposition
  pressSpecifications(
    tenantId: ID!
    workCenterId: ID
    isActive: Boolean
  ): [PressSpecification!]!

  substrateSpecifications(
    tenantId: ID!
    materialId: ID
    isActive: Boolean
  ): [SubstrateSpecification!]!

  impositionTemplates(
    tenantId: ID!
    packagingType: String
    pressId: ID
    isActive: Boolean
  ): [ImpositionTemplate!]!

  layoutCalculations(
    tenantId: ID!
    productId: ID
    pressId: ID
    salesOrderLineId: ID
    quoteLineId: ID
  ): [LayoutCalculation!]!

  impositionMarks(
    tenantId: ID!
    markType: String
    isActive: Boolean
  ): [ImpositionMark!]!
}

# =====================================================
# MUTATIONS
# =====================================================

type Mutation {
  # Quality
  createQualityInspection(
    tenantId: ID!
    facilityId: ID!
    inspectionType: InspectionType!
    inspectorUserId: ID!
    inspectionTemplateId: ID
  ): QualityInspection!

  updateQualityInspection(
    id: ID!
    passFail: PassFail
    disposition: InspectionDisposition
    inspectionResults: JSON
  ): QualityInspection!

  createQualityDefect(
    tenantId: ID!
    defectDescription: String!
    defectSeverity: DefectSeverity
    qualityInspectionId: ID
    productionRunId: ID
  ): QualityDefect!

  updateQualityDefect(
    id: ID!
    status: DefectStatus
    correctiveAction: String
    preventiveAction: String
  ): QualityDefect!

  createCustomerRejection(
    tenantId: ID!
    customerId: ID!
    rejectionDate: Date!
    rejectionReason: String!
    quantityRejected: Float
  ): CustomerRejection!

  updateCustomerRejection(
    id: ID!
    status: RejectionStatus
    disposition: RejectionDisposition
    financialImpact: Float
  ): CustomerRejection!

  # HR
  createEmployee(
    tenantId: ID!
    employeeNumber: String!
    firstName: String!
    lastName: String!
    jobTitle: String
    department: String
  ): Employee!

  updateEmployee(
    id: ID!
    jobTitle: String
    department: String
    basePayRate: Float
  ): Employee!

  deleteEmployee(id: ID!): Boolean!

  createTimecard(
    tenantId: ID!
    facilityId: ID!
    employeeId: ID!
    timecardDate: Date!
    clockIn: DateTime
    clockOut: DateTime
  ): Timecard!

  approveTimecard(
    id: ID!
    approvedByUserId: ID!
  ): Timecard!

  # IoT
  createIotDevice(
    tenantId: ID!
    facilityId: ID!
    deviceCode: String!
    deviceName: String!
    deviceType: String
    workCenterId: ID
  ): IotDevice!

  updateIotDevice(
    id: ID!
    deviceName: String
    isActive: Boolean
  ): IotDevice!

  createSensorReading(
    tenantId: ID!
    iotDeviceId: ID!
    sensorType: String
    readingValue: Float
    unitOfMeasure: String
  ): SensorReading!

  acknowledgeEquipmentEvent(
    id: ID!
    acknowledgedByUserId: ID!
  ): EquipmentEvent!

  # Security
  createSecurityZone(
    tenantId: ID!
    facilityId: ID!
    zoneCode: String!
    zoneName: String!
    zoneLevel: SecurityZoneLevel!
  ): SecurityZone!

  updateSecurityZone(
    id: ID!
    zoneName: String
    requiresBiometric: Boolean
  ): SecurityZone!

  logSecurityAccess(
    tenantId: ID!
    securityZoneId: ID!
    userId: ID!
    accessType: AccessType!
    accessMethod: AccessMethod!
    granted: Boolean!
  ): SecurityAccessLog!

  createChainOfCustodyTransfer(
    tenantId: ID!
    itemType: String!
    itemId: ID!
    toUserId: ID!
    toLocationId: ID!
    fromUserId: ID
    fromLocationId: ID
  ): ChainOfCustody!

  # Marketplace
  createPartnerProfile(
    tenantId: ID!
    companyCode: String!
    companyName: String!
    companyType: String
  ): PartnerNetworkProfile!

  createJobPosting(
    tenantId: ID!
    postingCompanyId: ID!
    jobDescription: String!
    quantity: Float!
    estimatedBudget: Float
  ): MarketplaceJobPosting!

  createMarketplaceBid(
    tenantId: ID!
    jobPostingId: ID!
    biddingCompanyId: ID!
    bidAmount: Float!
  ): MarketplaceBid!

  awardJobPosting(
    jobPostingId: ID!
    awardedToCompanyId: ID!
  ): MarketplaceJobPosting!

  createExternalOrder(
    tenantId: ID!
    originatingCompanyId: ID!
    fulfillingCompanyId: ID!
    quantity: Float!
    orderAmount: Float!
  ): ExternalCompanyOrder!

  updateExternalOrder(
    id: ID!
    status: ExternalOrderStatus
    actualDeliveryDate: Date
    qualityRating: Float
  ): ExternalCompanyOrder!

  # Imposition
  createPressSpecification(
    tenantId: ID!
    workCenterId: ID!
    maxSheetWidth: Float!
    maxSheetHeight: Float!
    minSheetWidth: Float!
    minSheetHeight: Float!
  ): PressSpecification!

  createImpositionTemplate(
    tenantId: ID!
    templateCode: String!
    templateName: String!
    packagingType: String
    pressId: ID
  ): ImpositionTemplate!

  calculateLayout(
    tenantId: ID!
    productId: ID!
    pressId: ID!
    designWidth: Float!
    designHeight: Float!
    sheetWidth: Float!
    sheetHeight: Float!
  ): LayoutCalculation!
}
