# =====================================================
# TENANT SCHEMA
# =====================================================
# Multi-tenant foundation types
# Created: 2025-12-16
# =====================================================

"""
Tenant - Multi-tenant isolation entity
Each customer/organization gets their own tenant with complete data isolation
"""
type Tenant {
  id: ID!
  tenantCode: String!
  tenantName: String!
  legalEntityName: String

  # Subscription
  subscriptionTier: SubscriptionTier!
  status: TenantStatus!

  # Contact
  primaryContactName: String
  primaryContactEmail: String
  primaryContactPhone: String

  # Address
  billingAddressLine1: String
  billingAddressLine2: String
  billingCity: String
  billingState: String
  billingPostalCode: String
  billingCountry: String

  # Tax
  taxId: String
  taxExempt: Boolean!

  # Configuration
  defaultCurrencyCode: String!
  defaultTimezone: String!
  defaultLanguage: String!

  # Feature flags
  enabledFeatures: [String!]!
  customConfiguration: JSON

  # Usage limits
  userLimit: Int
  facilityLimit: Int
  storageLimitGb: Int

  # SCD Type 2
  effectiveFrom: DateTime!
  effectiveTo: DateTime
  isCurrent: Boolean!
  versionNumber: Int!

  # Relationships
  facilities: [Facility!]!
  users: [User!]!
  billingEntities: [BillingEntity!]!

  # Audit
  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

"""
Subscription tier determines feature access
"""
enum SubscriptionTier {
  STARTER
  PROFESSIONAL
  ENTERPRISE
}

"""
Tenant status
"""
enum TenantStatus {
  ACTIVE
  SUSPENDED
  TRIAL
  CANCELLED
}

"""
Billing entity for complex multi-entity organizations
"""
type BillingEntity {
  id: ID!
  tenantId: ID!

  entityCode: String!
  entityName: String!
  legalName: String

  # Contact
  billingContactName: String
  billingContactEmail: String!
  billingContactPhone: String

  # Address
  addressLine1: String!
  addressLine2: String
  city: String!
  state: String
  postalCode: String!
  country: String!

  # Tax
  taxId: String
  vatNumber: String
  taxExempt: Boolean!
  taxExemptionCertificate: String

  # Payment
  paymentTerms: String!
  creditLimit: Float

  # Currency
  billingCurrencyCode: String!

  # Status
  isActive: Boolean!

  # Relationships
  tenant: Tenant!

  # Audit
  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

"""
Facility - Physical location (warehouse, manufacturing plant, sales office)
"""
type Facility {
  id: ID!
  tenantId: ID!

  facilityCode: String!
  facilityName: String!
  facilityType: FacilityType!

  # Contact
  managerName: String
  contactEmail: String
  contactPhone: String

  # Address
  addressLine1: String!
  addressLine2: String
  city: String!
  state: String
  postalCode: String!
  country: String!

  # Geographic
  latitude: Float
  longitude: Float

  # Capabilities
  isWarehouse: Boolean!
  isManufacturing: Boolean!
  isSalesOffice: Boolean!

  # Warehouse
  totalSquareFeet: Float
  usableSquareFeet: Float
  dockDoorsCount: Int

  # Manufacturing
  productionCapacity: JSON

  # Operating
  timezone: String!
  operatingHours: JSON

  # Multi-region
  deploymentRegion: String

  # Status
  isActive: Boolean!
  openedDate: Date
  closedDate: Date

  # Relationships
  tenant: Tenant!
  workCenters: [WorkCenter!]!
  inventoryLocations: [InventoryLocation!]!

  # Audit
  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

"""
Facility type
"""
enum FacilityType {
  WAREHOUSE
  MANUFACTURING
  SALES_OFFICE
  DISTRIBUTION_CENTER
  THREE_PL_WAREHOUSE
}

"""
User - User account with RBAC and biometric support
"""
type User {
  id: ID!
  tenantId: ID!

  username: String!
  email: String!

  # Authentication (password hash not exposed)
  ssoProvider: String
  ssoUserId: String

  # MFA
  mfaEnabled: Boolean!

  # Biometric
  biometricEnrolled: Boolean!

  # Personal
  firstName: String
  lastName: String
  displayName: String

  # Contact
  phone: String
  mobile: String

  # Employee
  employeeId: ID

  # Default facility
  defaultFacilityId: ID
  defaultFacility: Facility

  # Preferences
  preferredLanguage: String!
  preferredTimezone: String!
  preferredCurrencyCode: String!
  uiTheme: String!

  # RBAC
  roles: [String!]!
  permissions: [String!]!

  # Security clearance (5-tier)
  securityClearanceLevel: SecurityClearanceLevel

  # Status
  isActive: Boolean!
  isLocked: Boolean!
  failedLoginAttempts: Int!
  lastLoginAt: DateTime
  passwordChangedAt: DateTime
  passwordExpiresAt: DateTime

  # Relationships
  tenant: Tenant!

  # Audit
  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

"""
Security clearance levels (5-tier security zones)
"""
enum SecurityClearanceLevel {
  STANDARD
  RESTRICTED
  SECURE
  HIGH_SECURITY
  VAULT
}

"""
Currency for multi-currency support
"""
type Currency {
  id: ID!

  currencyCode: String!
  currencyName: String!
  currencySymbol: String

  # Display
  decimalPlaces: Int!
  thousandsSeparator: String!
  decimalSeparator: String!
  symbolPosition: String!

  # Status
  isActive: Boolean!

  # Audit
  createdAt: DateTime!
  updatedAt: DateTime
}

# =====================================================
# QUERIES
# =====================================================

extend type Query {
  """Get tenant by ID"""
  tenant(id: ID!): Tenant

  """Get current user's tenant"""
  myTenant: Tenant!

  """List all facilities for a tenant"""
  facilities(tenantId: ID!): [Facility!]!

  """Get facility by ID"""
  facility(id: ID!): Facility

  """Get current user"""
  me: User!

  """List users for a tenant"""
  users(tenantId: ID!, limit: Int, offset: Int): UserConnection!

  """List all active currencies"""
  currencies: [Currency!]!
}

# =====================================================
# MUTATIONS
# =====================================================

extend type Mutation {
  """Create a new tenant"""
  createTenant(input: CreateTenantInput!): Tenant!

  """Update tenant"""
  updateTenant(id: ID!, input: UpdateTenantInput!): Tenant!

  """Create facility"""
  createFacility(input: CreateFacilityInput!): Facility!

  """Update facility"""
  updateFacility(id: ID!, input: UpdateFacilityInput!): Facility!

  """Create user"""
  createUser(input: CreateUserInput!): User!

  """Update user"""
  updateUser(id: ID!, input: UpdateUserInput!): User!

  """Update user preferences"""
  updateMyPreferences(input: UpdateUserPreferencesInput!): User!
}

# =====================================================
# INPUT TYPES
# =====================================================

input CreateTenantInput {
  tenantCode: String!
  tenantName: String!
  legalEntityName: String
  subscriptionTier: SubscriptionTier!
  primaryContactEmail: String!
  defaultCurrencyCode: String
  defaultLanguage: String
}

input UpdateTenantInput {
  tenantName: String
  legalEntityName: String
  subscriptionTier: SubscriptionTier
  status: TenantStatus
  primaryContactName: String
  primaryContactEmail: String
  primaryContactPhone: String
  enabledFeatures: [String!]
}

input CreateFacilityInput {
  tenantId: ID!
  facilityCode: String!
  facilityName: String!
  facilityType: FacilityType!
  addressLine1: String!
  city: String!
  postalCode: String!
  country: String!
  deploymentRegion: String
}

input UpdateFacilityInput {
  facilityName: String
  managerName: String
  contactEmail: String
  contactPhone: String
  isActive: Boolean
}

input CreateUserInput {
  tenantId: ID!
  username: String!
  email: String!
  firstName: String!
  lastName: String!
  roles: [String!]!
  securityClearanceLevel: SecurityClearanceLevel
}

input UpdateUserInput {
  firstName: String
  lastName: String
  displayName: String
  phone: String
  mobile: String
  roles: [String!]
  securityClearanceLevel: SecurityClearanceLevel
  isActive: Boolean
}

input UpdateUserPreferencesInput {
  preferredLanguage: String
  preferredTimezone: String
  preferredCurrencyCode: String
  uiTheme: String
  defaultFacilityId: ID
}

# =====================================================
# CONNECTION TYPES (for pagination)
# =====================================================

type UserConnection {
  edges: [UserEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type UserEdge {
  node: User!
  cursor: String!
}

type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: String
  endCursor: String
}

# =====================================================
# SCALAR TYPES
# =====================================================

"""ISO 8601 DateTime"""
scalar DateTime

"""ISO 8601 Date"""
scalar Date

"""JSON scalar type"""
scalar JSON
