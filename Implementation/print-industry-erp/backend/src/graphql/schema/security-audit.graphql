# =====================================================
# SECURITY AUDIT DASHBOARD SCHEMA
# REQ-DEVOPS-SECURITY-1767150339448
# =====================================================
# Comprehensive security monitoring, threat detection, and compliance reporting
# =====================================================

type Query {
  """
  Get real-time security dashboard overview
  """
  securityOverview(
    timeRange: SecurityTimeRange!
  ): SecurityOverview!

  """
  Get security audit events with filtering
  """
  securityAuditEvents(
    filter: SecurityEventFilter
    pagination: PaginationInput
  ): SecurityAuditEventsConnection!

  """
  Get top suspicious IP addresses
  """
  suspiciousIPs(
    hours: Int = 24
    limit: Int = 10
  ): [SuspiciousIP!]!

  """
  Get user security activity timeline
  """
  userSecurityTimeline(
    userId: ID!
    hours: Int = 24
  ): [SecurityEvent!]!

  """
  Get active security incidents
  """
  securityIncidents(
    status: [IncidentStatus!]
    severity: [SecurityRiskLevel!]
    pagination: PaginationInput
  ): SecurityIncidentsConnection!

  """
  Get security incident details
  """
  securityIncident(id: ID!): SecurityIncident!

  """
  Get threat detection patterns
  """
  threatPatterns(
    enabled: Boolean
  ): [ThreatPattern!]!

  """
  Get compliance audit trail
  """
  complianceAuditTrail(
    framework: String
    controlId: String
    status: ComplianceStatus
    pagination: PaginationInput
  ): ComplianceAuditConnection!

  """
  Get security metrics time series
  """
  securityMetricsTimeSeries(
    timeRange: SecurityTimeRange!
    interval: String = "1h"
  ): [SecurityMetricsPoint!]!

  """
  Get geographic access heatmap data
  """
  geographicAccessMap(
    hours: Int = 24
  ): [GeographicAccess!]!
}

type Mutation {
  """
  Create a new security incident
  """
  createSecurityIncident(
    input: CreateSecurityIncidentInput!
  ): SecurityIncident!

  """
  Update security incident status
  """
  updateSecurityIncident(
    id: ID!
    input: UpdateSecurityIncidentInput!
  ): SecurityIncident!

  """
  Create or update threat detection pattern
  """
  upsertThreatPattern(
    input: ThreatPatternInput!
  ): ThreatPattern!

  """
  Enable/disable threat pattern
  """
  toggleThreatPattern(
    id: ID!
    enabled: Boolean!
  ): ThreatPattern!

  """
  Log a security audit event (for manual logging)
  """
  logSecurityEvent(
    input: LogSecurityEventInput!
  ): SecurityEvent!

  """
  Add compliance audit entry
  """
  addComplianceAuditEntry(
    input: ComplianceAuditInput!
  ): ComplianceAuditEntry!
}

# =====================================================
# DASHBOARD OVERVIEW
# =====================================================

type SecurityOverview {
  timeRange: SecurityTimeRange!

  # Overall security posture
  securityScore: Float! # 0-100 score
  trend: SecurityTrend!

  # Event counts
  totalEvents: Int!
  criticalEvents: Int!
  highRiskEvents: Int!
  suspiciousEvents: Int!
  blockedEvents: Int!

  # Authentication metrics
  loginAttempts: Int!
  failedLogins: Int!
  successRate: Float!
  bruteForceAttempts: Int!

  # Access control metrics
  permissionDenials: Int!
  zoneAccessEvents: Int!
  unauthorizedAccessAttempts: Int!

  # Data security
  dataExports: Int!
  dataModifications: Int!
  configChanges: Int!

  # Active threats
  activeIncidents: Int!
  openInvestigations: Int!
  topThreats: [ThreatSummary!]!

  # Geographic insights
  uniqueCountries: Int!
  uniqueIPAddresses: Int!
  topCountries: [CountryAccessSummary!]!

  # User activity
  activeUsers: Int!
  suspiciousUsers: [SuspiciousUserSummary!]!

  # Compliance status
  complianceScore: Float!
  nonCompliantControls: Int!
}

# =====================================================
# SECURITY EVENTS
# =====================================================

type SecurityEvent {
  id: ID!
  eventType: SecurityEventType!
  eventTimestamp: DateTime!
  correlationId: String

  # Actor
  userId: ID
  username: String
  ipAddress: String!
  userAgent: String
  sessionId: String

  # Target
  targetResource: String
  targetType: String

  # Risk assessment
  riskLevel: SecurityRiskLevel!
  success: Boolean!
  failureReason: String
  metadata: JSON

  # Location
  countryCode: String
  city: String
  location: GeoPoint

  # Threat detection
  anomalyScore: Float
  flaggedSuspicious: Boolean!
  autoBlocked: Boolean!

  createdAt: DateTime!
}

type SecurityAuditEventsConnection {
  edges: [SecurityEventEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type SecurityEventEdge {
  node: SecurityEvent!
  cursor: String!
}

# =====================================================
# SUSPICIOUS ACTIVITY
# =====================================================

type SuspiciousIP {
  ipAddress: String!
  eventCount: Int!
  failedLoginCount: Int!
  suspiciousEventCount: Int!
  riskScore: Float!
  countries: [String!]!
  lastSeenAt: DateTime
  blocked: Boolean!
}

type SuspiciousUserSummary {
  userId: ID!
  username: String!
  suspiciousEventCount: Int!
  riskScore: Float!
  lastSuspiciousActivity: DateTime!
  flaggedReasons: [String!]!
}

# =====================================================
# SECURITY INCIDENTS
# =====================================================

type SecurityIncident {
  id: ID!
  incidentNumber: String!
  title: String!
  description: String

  # Classification
  incidentType: SecurityEventType!
  severity: SecurityRiskLevel!
  status: IncidentStatus!

  # Related data
  relatedEventIds: [ID!]!
  relatedEvents: [SecurityEvent!]!
  threatPattern: ThreatPattern

  # Impact
  affectedUsers: [User!]!
  affectedResources: [String!]!
  estimatedImpact: String

  # Response
  assignedTo: User
  resolutionNotes: String
  remediationActions: JSON

  # Timeline
  detectedAt: DateTime!
  acknowledgedAt: DateTime
  resolvedAt: DateTime

  createdAt: DateTime!
  updatedAt: DateTime
  createdBy: User
  updatedBy: User
}

type SecurityIncidentsConnection {
  edges: [SecurityIncidentEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type SecurityIncidentEdge {
  node: SecurityIncident!
  cursor: String!
}

# =====================================================
# THREAT PATTERNS
# =====================================================

type ThreatPattern {
  id: ID!
  patternName: String!
  patternDescription: String
  severity: SecurityRiskLevel!

  # Detection
  detectionRules: JSON!
  matchCount: Int! # How many times this pattern has matched

  # Actions
  autoBlock: Boolean!
  alertChannels: [String!]!

  # Status
  enabled: Boolean!
  createdAt: DateTime!
  updatedAt: DateTime
  createdBy: User
  updatedBy: User
}

type ThreatSummary {
  patternName: String!
  severity: SecurityRiskLevel!
  occurrences: Int!
  lastOccurrence: DateTime!
}

# =====================================================
# COMPLIANCE AUDIT
# =====================================================

type ComplianceAuditEntry {
  id: ID!
  framework: String!
  controlId: String!
  controlDescription: String

  # Event
  auditTimestamp: DateTime!
  eventDescription: String!
  eventType: String!

  # Evidence
  evidenceType: String
  evidenceLocation: String
  evidenceMetadata: JSON

  # Parties
  performedBy: User
  reviewedBy: User

  # Status
  complianceStatus: ComplianceStatus!
  findings: String

  createdAt: DateTime!
}

type ComplianceAuditConnection {
  edges: [ComplianceAuditEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type ComplianceAuditEdge {
  node: ComplianceAuditEntry!
  cursor: String!
}

# =====================================================
# METRICS & ANALYTICS
# =====================================================

type SecurityMetricsPoint {
  timestamp: DateTime!

  # Event counts
  totalEvents: Int!
  loginEvents: Int!
  failedLogins: Int!
  permissionDenials: Int!
  zoneAccessEvents: Int!
  dataExports: Int!

  # Risk metrics
  criticalEvents: Int!
  highRiskEvents: Int!
  suspiciousEvents: Int!
  autoBlockedEvents: Int!

  # Unique metrics
  uniqueUsers: Int!
  uniqueIPAddresses: Int!
  uniqueSessions: Int!

  # Anomaly metrics
  avgAnomalyScore: Float
  maxAnomalyScore: Float

  # Success rates
  successRatePercent: Float!
}

type GeographicAccess {
  countryCode: String!
  countryName: String
  accessCount: Int!
  failedLoginCount: Int!
  suspiciousEventCount: Int!
  uniqueUsers: Int!
  location: GeoPoint
}

type CountryAccessSummary {
  countryCode: String!
  countryName: String
  accessCount: Int!
  percentage: Float!
}

# =====================================================
# INPUT TYPES
# =====================================================

input SecurityEventFilter {
  eventTypes: [SecurityEventType!]
  riskLevels: [SecurityRiskLevel!]
  userId: ID
  ipAddress: String
  success: Boolean
  flaggedSuspicious: Boolean
  startDate: DateTime
  endDate: DateTime
  searchQuery: String
}

input CreateSecurityIncidentInput {
  title: String!
  description: String
  incidentType: SecurityEventType!
  severity: SecurityRiskLevel!
  relatedEventIds: [ID!]
  affectedUserIds: [ID!]
  affectedResources: [String!]
  estimatedImpact: String
  assignedToUserId: ID
}

input UpdateSecurityIncidentInput {
  title: String
  description: String
  status: IncidentStatus
  severity: SecurityRiskLevel
  assignedToUserId: ID
  resolutionNotes: String
  remediationActions: JSON
}

input ThreatPatternInput {
  id: ID
  patternName: String!
  patternDescription: String
  severity: SecurityRiskLevel!
  detectionRules: JSON!
  autoBlock: Boolean
  alertChannels: [String!]
  enabled: Boolean
}

input LogSecurityEventInput {
  eventType: SecurityEventType!
  userId: ID
  username: String
  ipAddress: String!
  userAgent: String
  targetResource: String
  targetType: String
  riskLevel: SecurityRiskLevel
  success: Boolean!
  failureReason: String
  metadata: JSON
  correlationId: String
}

input ComplianceAuditInput {
  framework: String!
  controlId: String!
  controlDescription: String
  eventDescription: String!
  eventType: String!
  evidenceType: String
  evidenceLocation: String
  evidenceMetadata: JSON
  performedByUserId: ID
  reviewedByUserId: ID
  complianceStatus: ComplianceStatus
  findings: String
}

input PaginationInput {
  first: Int
  after: String
  last: Int
  before: String
}

# =====================================================
# ENUMS
# =====================================================

enum SecurityEventType {
  LOGIN_SUCCESS
  LOGIN_FAILED
  LOGOUT
  PASSWORD_CHANGE
  PASSWORD_RESET
  PERMISSION_DENIED
  ZONE_ACCESS_GRANTED
  ZONE_ACCESS_DENIED
  SUSPICIOUS_ACTIVITY
  DATA_EXPORT
  DATA_MODIFICATION
  CONFIG_CHANGE
  USER_CREATED
  USER_MODIFIED
  USER_DELETED
  ROLE_CHANGED
  API_KEY_CREATED
  API_KEY_REVOKED
  SESSION_TIMEOUT
  CONCURRENT_SESSION
  BRUTE_FORCE_ATTEMPT
}

enum SecurityRiskLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum IncidentStatus {
  OPEN
  INVESTIGATING
  RESOLVED
  FALSE_POSITIVE
  CLOSED
}

enum ComplianceStatus {
  COMPLIANT
  NON_COMPLIANT
  REMEDIATED
  PENDING_REVIEW
}

enum SecurityTimeRange {
  LAST_HOUR
  LAST_6_HOURS
  LAST_24_HOURS
  LAST_7_DAYS
  LAST_30_DAYS
  CUSTOM
}

enum SecurityTrend {
  IMPROVING
  STABLE
  DEGRADING
  CRITICAL
}

# =====================================================
# SHARED TYPES
# =====================================================

type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: String
  endCursor: String
}

type GeoPoint {
  latitude: Float!
  longitude: Float!
}

type User {
  id: ID!
  username: String!
  email: String
  firstName: String
  lastName: String
}

scalar DateTime
scalar JSON
