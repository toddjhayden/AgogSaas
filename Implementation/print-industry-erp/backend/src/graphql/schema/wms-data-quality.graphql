# WMS Data Quality Schema
# Author: Roy (Backend Developer)
# Requirement: REQ-STRATEGIC-AUTO-1766545799451
# Purpose: GraphQL schema for bin optimization data quality features

# =====================================================
# INPUT TYPES
# =====================================================

input DimensionVerificationInput {
  facilityId: ID!
  materialId: ID!
  measuredCubicFeet: Float!
  measuredWeightLbs: Float!
  measuredWidthInches: Float
  measuredHeightInches: Float
  measuredThicknessInches: Float
  notes: String
}

input CrossDockCancellationInput {
  facilityId: ID!
  materialId: ID!
  lotNumber: String!
  originalRecommendationId: ID
  originalStagingLocationId: ID
  originalSalesOrderId: ID
  cancellationReason: CrossDockCancellationReason!
  notes: String
}

# =====================================================
# ENUMS
# =====================================================

enum CrossDockCancellationReason {
  ORDER_CANCELLED
  ORDER_DELAYED
  QUANTITY_MISMATCH
  MATERIAL_QUALITY_ISSUE
  MANUAL_OVERRIDE
}

enum VerificationStatus {
  VERIFIED
  VARIANCE_DETECTED
  MASTER_DATA_UPDATED
}

enum CapacityFailureType {
  CUBIC_FEET_EXCEEDED
  WEIGHT_EXCEEDED
  BOTH_EXCEEDED
}

# =====================================================
# OUTPUT TYPES
# =====================================================

type DimensionVerificationResult {
  verificationId: ID!
  success: Boolean!
  cubicFeetVariancePct: Float!
  weightVariancePct: Float!
  varianceThresholdExceeded: Boolean!
  autoUpdatedMasterData: Boolean!
  verificationStatus: VerificationStatus!
  message: String!
}

type CrossDockCancellationResult {
  cancellationId: ID!
  success: Boolean!
  newRecommendedLocation: Location
  message: String!
}

type Location {
  locationId: ID!
  locationCode: String!
}

type DataQualityMetrics {
  facilityId: ID!
  facilityName: String!
  materialsVerifiedCount: Int!
  materialsWithVariance: Int!
  avgCubicFeetVariancePct: Float!
  avgWeightVariancePct: Float!
  capacityFailuresCount: Int!
  unresolvedFailuresCount: Int!
  crossdockCancellationsCount: Int!
  pendingRelocationsCount: Int!
  autoRemediationCount: Int!
  failedRemediationCount: Int!
}

type MaterialDimensionVerification {
  verificationId: ID!
  materialId: ID!
  facilityId: ID!
  masterCubicFeet: Float
  masterWeightLbs: Float
  measuredCubicFeet: Float!
  measuredWeightLbs: Float!
  cubicFeetVariancePct: Float
  weightVariancePct: Float
  verificationStatus: VerificationStatus!
  varianceThresholdExceeded: Boolean!
  autoUpdatedMasterData: Boolean!
  verifiedBy: ID!
  verifiedAt: String!
  notes: String
}

type CapacityValidationFailure {
  failureId: ID!
  locationId: ID!
  locationCode: String!
  materialId: ID!
  materialCode: String!
  lotNumber: String
  requiredCubicFeet: Float!
  availableCubicFeet: Float!
  requiredWeightLbs: Float!
  availableWeightLbs: Float!
  failureType: CapacityFailureType!
  cubicFeetOverflowPct: Float!
  weightOverflowPct: Float!
  alertSent: Boolean!
  resolved: Boolean!
  createdAt: String!
}

type CrossDockCancellation {
  cancellationId: ID!
  materialId: ID!
  materialCode: String!
  lotNumber: String!
  cancellationReason: CrossDockCancellationReason!
  newRecommendedLocationId: ID
  newRecommendedLocationCode: String
  relocationCompleted: Boolean!
  cancelledAt: String!
  cancelledBy: ID!
  notes: String
}

type HealthCheckResultEnhanced {
  status: HealthStatus!
  message: String!
  remediationActions: [RemediationAction!]!
  timestamp: String!
}

type RemediationAction {
  action: RemediationActionType!
  successful: Boolean!
  preActionMetric: Float
  postActionMetric: Float
  errorMessage: String
}

enum RemediationActionType {
  CACHE_REFRESHED
  ML_RETRAINING_SCHEDULED
  CONGESTION_CACHE_CLEARED
  INDEX_REBUILT
  DEVOPS_ALERTED
}

enum HealthStatus {
  HEALTHY
  DEGRADED
  UNHEALTHY
}

# =====================================================
# QUERIES
# =====================================================

type Query {
  """
  Get data quality metrics for a facility
  """
  getDataQualityMetrics(facilityId: ID): [DataQualityMetrics!]!

  """
  Get dimension verifications for a material
  """
  getMaterialDimensionVerifications(
    materialId: ID!
    facilityId: ID
    limit: Int = 10
  ): [MaterialDimensionVerification!]!

  """
  Get capacity validation failures (unresolved by default)
  """
  getCapacityValidationFailures(
    facilityId: ID
    resolved: Boolean = false
    limit: Int = 50
  ): [CapacityValidationFailure!]!

  """
  Get cross-dock cancellations (pending relocation by default)
  """
  getCrossDockCancellations(
    facilityId: ID
    relocationCompleted: Boolean = false
    limit: Int = 50
  ): [CrossDockCancellation!]!

  """
  Get bin optimization health with auto-remediation
  """
  getBinOptimizationHealthEnhanced(
    autoRemediate: Boolean = true
  ): HealthCheckResultEnhanced!
}

# =====================================================
# MUTATIONS
# =====================================================

type Mutation {
  """
  Verify material dimensions and update master data if variance is acceptable
  Reference: Sylvia critique lines 1030-1046
  """
  verifyMaterialDimensions(
    input: DimensionVerificationInput!
  ): DimensionVerificationResult!

  """
  Cancel cross-docking and get new putaway location
  Reference: Sylvia critique lines 405-414
  """
  cancelCrossDocking(
    input: CrossDockCancellationInput!
  ): CrossDockCancellationResult!

  """
  Resolve a capacity validation failure
  """
  resolveCapacityFailure(
    failureId: ID!
    resolutionNotes: String
  ): Boolean!

  """
  Mark cross-dock relocation as completed
  """
  completeCrossDockRelocation(
    cancellationId: ID!
    actualLocationId: ID!
  ): Boolean!
}
