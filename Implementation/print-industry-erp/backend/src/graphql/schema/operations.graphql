# =====================================================
# OPERATIONS SCHEMA
# =====================================================
# Production planning, scheduling, OEE tracking
# Created: 2025-12-17
# =====================================================

"""
WorkCenter - Manufacturing equipment (presses, bindery, finishing)
"""
type WorkCenter {
  id: ID!
  tenantId: ID!
  facilityId: ID!

  # Identification
  workCenterCode: String!
  workCenterName: String!
  workCenterType: WorkCenterType!

  # Equipment details
  manufacturer: String
  model: String
  serialNumber: String
  assetTag: String

  # Press specifications (for imposition engine)
  sheetWidthMax: Float
  sheetHeightMax: Float
  sheetWidthMin: Float
  sheetHeightMin: Float
  dimensionUnit: String
  gripperMargin: Float
  sideMargins: Float
  maxColors: Int

  # Capacity
  productionRatePerHour: Float
  productionUnit: ProductionUnit

  # Costs
  hourlyRate: Float
  setupCost: Float
  costPerUnit: Float

  # Maintenance
  lastMaintenanceDate: Date
  nextMaintenanceDate: Date
  maintenanceIntervalDays: Int

  # Status
  status: WorkCenterStatus!
  isActive: Boolean!

  # Configuration
  operatingCalendar: JSON
  capabilities: JSON

  # SCD Type 2
  effectiveFromDate: Date!
  effectiveToDate: Date
  isCurrentVersion: Boolean!

  # Relationships
  facility: Facility!
  productionRuns: [ProductionRun!]!
  maintenanceRecords: [MaintenanceRecord!]!
  equipmentStatusLog: [EquipmentStatusLog!]!

  # Audit
  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

"""
ProductionOrder - High-level production order from sales
"""
type ProductionOrder {
  id: ID!
  tenantId: ID!
  facilityId: ID!

  # Identification
  productionOrderNumber: String!
  salesOrderId: ID
  salesOrderLineId: ID

  # Product
  productId: ID!
  productCode: String
  productDescription: String

  # Quantity
  quantityOrdered: Float!
  quantityCompleted: Float!
  quantityScrap: Float!
  unitOfMeasure: String

  # Manufacturing strategy
  manufacturingStrategy: ManufacturingStrategy

  # Scheduling
  priority: Int!
  dueDate: Date
  plannedStartDate: DateTime
  plannedCompletionDate: DateTime
  actualStartDate: DateTime
  actualCompletionDate: DateTime

  # Status
  status: ProductionOrderStatus!

  # Routing
  routingId: ID

  # Costs
  estimatedMaterialCost: Float
  estimatedLaborCost: Float
  estimatedOverheadCost: Float
  actualMaterialCost: Float
  actualLaborCost: Float
  actualOverheadCost: Float

  # Notes
  specialInstructions: String
  qualityRequirements: String

  # Relationships
  facility: Facility!
  productionRuns: [ProductionRun!]!
  operations: [Operation!]!

  # Audit
  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

"""
Operation - Individual operation type (printing, die cutting, etc.)
"""
type Operation {
  id: ID!
  tenantId: ID!

  # Identification
  operationCode: String!
  operationName: String!
  operationType: OperationType!

  # Work center
  defaultWorkCenterId: ID
  defaultWorkCenter: WorkCenter

  # Time standards
  setupTimeMinutes: Float
  runTimePerUnitSeconds: Float

  # Costs
  setupCost: Float
  costPerUnit: Float

  # Quality
  inspectionRequired: Boolean!
  inspectionTemplateId: ID

  # Description
  description: String
  workInstructions: String

  # Status
  isActive: Boolean!

  # Audit
  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

"""
ProductionRun - Actual production execution on a work center
"""
type ProductionRun {
  id: ID!
  tenantId: ID!
  facilityId: ID!

  # Identification
  productionRunNumber: String!
  productionOrderId: ID!
  workCenterId: ID!
  operationId: ID!

  # Operator
  operatorUserId: ID
  operatorName: String

  # Timing
  setupStartTime: DateTime
  setupEndTime: DateTime
  startTimestamp: DateTime
  endTimestamp: DateTime

  # Quantities
  targetQuantity: Float!
  goodQuantity: Float!
  scrapQuantity: Float!
  unitOfMeasure: String

  # Performance
  actualSetupMinutes: Float
  actualRunMinutes: Float
  downtime: Float
  downtimeReason: String

  # Status
  status: ProductionRunStatus!

  # Notes
  notes: String

  # Relationships
  productionOrder: ProductionOrder!
  workCenter: WorkCenter!
  operation: Operation!

  # Audit
  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

"""
ChangeoverDetail - Changeover tracking between jobs
"""
type ChangeoverDetail {
  id: ID!
  tenantId: ID!

  workCenterId: ID!
  fromProductionRunId: ID
  toProductionRunId: ID

  changeoverStartTime: DateTime!
  changeoverEndTime: DateTime
  changeoverMinutes: Float

  changeoverType: String
  fromProductCode: String
  toProductCode: String

  crewSize: Int
  notes: String

  # Relationships
  workCenter: WorkCenter!

  # Audit
  createdAt: DateTime!
  createdBy: ID
}

"""
EquipmentStatusLog - Real-time equipment status tracking
"""
type EquipmentStatusLog {
  id: ID!
  tenantId: ID!

  workCenterId: ID!
  status: WorkCenterStatus!
  statusStartTime: DateTime!
  statusEndTime: DateTime
  durationMinutes: Float

  reason: String
  notes: String

  # Relationships
  workCenter: WorkCenter!

  # Audit
  createdAt: DateTime!
  createdBy: ID
}

"""
MaintenanceRecord - Preventive and corrective maintenance
"""
type MaintenanceRecord {
  id: ID!
  tenantId: ID!

  workCenterId: ID!
  maintenanceType: MaintenanceType!
  maintenanceDate: Date!

  scheduledDate: Date
  completedDate: Date
  downtime: Float

  description: String
  workPerformed: String
  partsReplaced: String
  costLabor: Float
  costParts: Float

  technicianName: String
  technicianUserId: ID

  nextMaintenanceDate: Date

  # Relationships
  workCenter: WorkCenter!

  # Audit
  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

"""
AssetHierarchy - Parent-child equipment relationships
"""
type AssetHierarchy {
  id: ID!
  tenantId: ID!

  parentAssetId: ID
  childAssetId: ID!

  relationshipType: String
  description: String

  # Audit
  createdAt: DateTime!
  createdBy: ID
}

"""
OEECalculation - Overall Equipment Effectiveness metrics
"""
type OEECalculation {
  id: ID!
  tenantId: ID!

  workCenterId: ID!
  calculationDate: Date!
  shiftNumber: Int

  # OEE Components
  availabilityPercent: Float!
  performancePercent: Float!
  qualityPercent: Float!
  oeePercent: Float!

  # Time breakdown (minutes)
  plannedProductionTime: Float!
  downtime: Float!
  operatingTime: Float!

  # Production
  idealCycleTime: Float
  totalPieces: Int!
  goodPieces: Int!
  rejectPieces: Int!

  # Losses
  availabilityLoss: Float
  performanceLoss: Float
  qualityLoss: Float

  notes: String

  # Relationships
  workCenter: WorkCenter!

  # Audit
  createdAt: DateTime!
  createdBy: ID
}

"""
ProductionSchedule - Production scheduling and capacity
"""
type ProductionSchedule {
  id: ID!
  tenantId: ID!

  scheduleDate: Date!
  shiftNumber: Int
  workCenterId: ID!
  productionOrderId: ID
  operationId: ID

  scheduledStartTime: DateTime!
  scheduledEndTime: DateTime!
  durationMinutes: Float

  status: ScheduleStatus!
  notes: String

  # Relationships
  workCenter: WorkCenter!
  productionOrder: ProductionOrder
  operation: Operation

  # Audit
  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

"""
CapacityPlanning - Capacity planning and what-if scenarios
"""
type CapacityPlanning {
  id: ID!
  tenantId: ID!

  planName: String!
  planType: String!
  startDate: Date!
  endDate: Date!

  workCenterId: ID
  facilityId: ID

  totalCapacityHours: Float!
  utilizationPercent: Float

  demandForecast: JSON
  capacityBreakdown: JSON

  notes: String

  # Relationships
  workCenter: WorkCenter
  facility: Facility

  # Audit
  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

# =====================================================
# ENUMS
# =====================================================

enum WorkCenterType {
  OFFSET_PRESS
  DIGITAL_PRESS
  FLEXO_PRESS
  GRAVURE_PRESS
  DIE_CUTTER
  FOLDER
  BINDERY
  FINISHING
  COATING
  LAMINATING
  EMBOSSING
  FOILING
  CUTTING
  PACKAGING
  INSPECTION
  OTHER
}

enum ProductionUnit {
  SHEETS
  IMPRESSIONS
  FEET
  METERS
  PIECES
  POUNDS
  KILOGRAMS
  HOURS
}

enum WorkCenterStatus {
  AVAILABLE
  IN_USE
  DOWN
  MAINTENANCE
  OFFLINE
  CHANGEOVER
}

enum ManufacturingStrategy {
  MTS
  MTO
  CTO
  ETO
  POD
  VDP
  LEAN
  DIGITAL
  MODIFY_TO_ORDER
}

enum ProductionOrderStatus {
  PLANNED
  RELEASED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  ON_HOLD
}

enum OperationType {
  PRINTING
  DIE_CUTTING
  FOLDING
  GLUING
  COATING
  LAMINATING
  EMBOSSING
  FOILING
  CUTTING
  BINDING
  STITCHING
  PERFECT_BINDING
  SADDLE_STITCH
  DRILLING
  PUNCHING
  PERFORATING
  SCORING
  NUMBERING
  INSPECTION
  PACKAGING
  OTHER
}

enum ProductionRunStatus {
  SCHEDULED
  IN_SETUP
  RUNNING
  PAUSED
  COMPLETED
  CANCELLED
}

enum MaintenanceType {
  PREVENTIVE
  CORRECTIVE
  PREDICTIVE
  EMERGENCY
  CALIBRATION
  INSPECTION
}

enum ScheduleStatus {
  SCHEDULED
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  RESCHEDULED
}

# =====================================================
# QUERIES
# =====================================================

extend type Query {
  """Get work center by ID (current version)"""
  workCenter(id: ID!): WorkCenter

  """List work centers for a facility (current versions only by default)"""
  workCenters(facilityId: ID!, status: WorkCenterStatus, includeHistory: Boolean): [WorkCenter!]!

  """Get work center as of a specific date (historical query)"""
  workCenterAsOf(workCenterCode: String!, facilityId: ID!, tenantId: ID!, asOfDate: Date!): WorkCenter

  """Get all versions of a work center (history)"""
  workCenterHistory(workCenterCode: String!, facilityId: ID!, tenantId: ID!): [WorkCenter!]!

  """Get production order by ID"""
  productionOrder(id: ID!): ProductionOrder

  """List production orders"""
  productionOrders(
    facilityId: ID!
    status: ProductionOrderStatus
    dueAfter: Date
    dueBefore: Date
    limit: Int
    offset: Int
  ): ProductionOrderConnection!

  """Get production run by ID"""
  productionRun(id: ID!): ProductionRun

  """List production runs"""
  productionRuns(
    facilityId: ID
    workCenterId: ID
    status: ProductionRunStatus
    startDate: DateTime
    endDate: DateTime
    limit: Int
    offset: Int
  ): [ProductionRun!]!

  """Get operation by ID"""
  operation(id: ID!): Operation

  """List operations"""
  operations(tenantId: ID!, type: OperationType): [Operation!]!

  """Get OEE calculations for work center"""
  oeeCalculations(
    workCenterId: ID!
    startDate: Date!
    endDate: Date!
  ): [OEECalculation!]!

  """Get production schedule"""
  productionSchedule(
    workCenterId: ID
    facilityId: ID
    startDate: Date!
    endDate: Date!
  ): [ProductionSchedule!]!

  """Get maintenance records"""
  maintenanceRecords(
    workCenterId: ID!
    startDate: Date
    endDate: Date
    type: MaintenanceType
  ): [MaintenanceRecord!]!

  """Get capacity planning"""
  capacityPlanning(
    facilityId: ID
    workCenterId: ID
    startDate: Date!
    endDate: Date!
  ): [CapacityPlanning!]!
}

# =====================================================
# MUTATIONS
# =====================================================

extend type Mutation {
  """Create work center"""
  createWorkCenter(input: CreateWorkCenterInput!): WorkCenter!

  """Update work center"""
  updateWorkCenter(id: ID!, input: UpdateWorkCenterInput!): WorkCenter!

  """Create production order"""
  createProductionOrder(input: CreateProductionOrderInput!): ProductionOrder!

  """Update production order"""
  updateProductionOrder(id: ID!, input: UpdateProductionOrderInput!): ProductionOrder!

  """Release production order"""
  releaseProductionOrder(id: ID!): ProductionOrder!

  """Create production run"""
  createProductionRun(input: CreateProductionRunInput!): ProductionRun!

  """Start production run"""
  startProductionRun(id: ID!): ProductionRun!

  """Complete production run"""
  completeProductionRun(
    id: ID!
    goodQuantity: Float!
    scrapQuantity: Float!
    notes: String
  ): ProductionRun!

  """Create operation"""
  createOperation(input: CreateOperationInput!): Operation!

  """Update operation"""
  updateOperation(id: ID!, input: UpdateOperationInput!): Operation!

  """Log equipment status"""
  logEquipmentStatus(input: LogEquipmentStatusInput!): EquipmentStatusLog!

  """Create maintenance record"""
  createMaintenanceRecord(input: CreateMaintenanceRecordInput!): MaintenanceRecord!

  """Calculate OEE"""
  calculateOEE(
    workCenterId: ID!
    calculationDate: Date!
    shiftNumber: Int
  ): OEECalculation!

  # =====================================================
  # PRODUCTION ANALYTICS QUERIES
  # =====================================================
  # REQ: REQ-STRATEGIC-AUTO-1767048328660 - Real-Time Production Analytics Dashboard

  """Get production summary for a facility"""
  productionSummary(facilityId: ID!): ProductionSummary!

  """Get production summaries by work center"""
  workCenterSummaries(facilityId: ID!): [ProductionSummary!]!

  """Get production run summaries with details"""
  productionRunSummaries(
    facilityId: ID!
    workCenterId: ID
    status: ProductionRunStatus
    limit: Int
  ): [ProductionRunSummary!]!

  """Get OEE trends over time"""
  oEETrends(
    facilityId: ID!
    workCenterId: ID
    startDate: Date
    endDate: Date
  ): [OEETrend!]!

  """Get work center utilization with current status"""
  workCenterUtilization(facilityId: ID!): [WorkCenterUtilization!]!

  """Get production alerts"""
  productionAlerts(facilityId: ID!): [ProductionAlert!]!
}

# =====================================================
# PRODUCTION ANALYTICS TYPES
# =====================================================
# REQ: REQ-STRATEGIC-AUTO-1767048328660 - Real-Time Production Analytics Dashboard

"""Production summary metrics aggregated by facility or work center"""
type ProductionSummary {
  facilityId: ID!
  workCenterId: ID
  workCenterName: String
  workCenterType: String
  activeRuns: Int!
  scheduledRuns: Int!
  completedRunsToday: Int!
  totalGoodQuantity: Float!
  totalScrapQuantity: Float!
  totalReworkQuantity: Float!
  averageYield: Float!
  currentOEE: Float
  asOfTimestamp: DateTime!
}

"""Production run summary with progress and metrics"""
type ProductionRunSummary {
  id: ID!
  productionRunNumber: String!
  productionOrderNumber: String!
  workCenterName: String!
  operatorName: String!
  status: ProductionRunStatus!
  scheduledStart: DateTime!
  scheduledEnd: DateTime!
  actualStart: DateTime
  actualEnd: DateTime
  quantityPlanned: Float!
  quantityGood: Float!
  quantityScrap: Float!
  quantityRework: Float!
  progressPercentage: Float!
  setupTimeMinutes: Float
  runTimeMinutes: Float
  downtimeMinutes: Float
  currentOEE: Float
}

"""OEE trend data point"""
type OEETrend {
  workCenterId: ID!
  workCenterName: String!
  calculationDate: Date!
  shift: String
  availabilityPercentage: Float!
  performancePercentage: Float!
  qualityPercentage: Float!
  oeePercentage: Float!
  targetOEEPercentage: Float!
}

"""Work center utilization and current status"""
type WorkCenterUtilization {
  workCenterId: ID!
  workCenterName: String!
  workCenterType: String!
  status: WorkCenterStatus!
  currentProductionRunId: ID
  currentProductionRunNumber: String
  currentOEE: Float
  todayRuntime: Float!
  todayDowntime: Float!
  todaySetupTime: Float!
  utilizationPercentage: Float!
  activeRunProgress: Float
}

"""Production alert for dashboard notifications"""
type ProductionAlert {
  id: ID!
  severity: AlertSeverity!
  type: AlertType!
  workCenterId: ID
  workCenterName: String
  productionRunId: ID
  productionRunNumber: String
  message: String!
  timestamp: DateTime!
  acknowledged: Boolean!
}

"""Alert severity levels"""
enum AlertSeverity {
  CRITICAL
  WARNING
  INFO
}

"""Alert type categories"""
enum AlertType {
  EQUIPMENT_DOWN
  QUALITY_ISSUE
  SCHEDULE_CONFLICT
  LOW_OEE
  MAINTENANCE_DUE
  HIGH_SCRAP_RATE
}

# =====================================================
# INPUT TYPES
# =====================================================

input CreateWorkCenterInput {
  facilityId: ID!
  workCenterCode: String!
  workCenterName: String!
  workCenterType: WorkCenterType!
  manufacturer: String
  model: String
  serialNumber: String
  productionRatePerHour: Float
  hourlyRate: Float
  setupCost: Float
}

input UpdateWorkCenterInput {
  workCenterName: String
  status: WorkCenterStatus
  productionRatePerHour: Float
  hourlyRate: Float
  lastMaintenanceDate: Date
  nextMaintenanceDate: Date
  isActive: Boolean
}

input CreateProductionOrderInput {
  facilityId: ID!
  productionOrderNumber: String!
  salesOrderId: ID
  salesOrderLineId: ID
  productId: ID!
  quantityOrdered: Float!
  unitOfMeasure: String
  manufacturingStrategy: ManufacturingStrategy
  priority: Int
  dueDate: Date
  specialInstructions: String
}

input UpdateProductionOrderInput {
  quantityOrdered: Float
  priority: Int
  dueDate: Date
  status: ProductionOrderStatus
  plannedStartDate: DateTime
  plannedCompletionDate: DateTime
  specialInstructions: String
}

input CreateProductionRunInput {
  productionOrderId: ID!
  workCenterId: ID!
  operationId: ID!
  targetQuantity: Float!
  unitOfMeasure: String
  operatorUserId: ID
}

input CreateOperationInput {
  operationCode: String!
  operationName: String!
  operationType: OperationType!
  defaultWorkCenterId: ID
  setupTimeMinutes: Float
  runTimePerUnitSeconds: Float
  setupCost: Float
  costPerUnit: Float
  description: String
}

input UpdateOperationInput {
  operationName: String
  defaultWorkCenterId: ID
  setupTimeMinutes: Float
  runTimePerUnitSeconds: Float
  isActive: Boolean
}

input LogEquipmentStatusInput {
  workCenterId: ID!
  status: WorkCenterStatus!
  reason: String
  notes: String
}

input CreateMaintenanceRecordInput {
  workCenterId: ID!
  maintenanceType: MaintenanceType!
  maintenanceDate: Date!
  scheduledDate: Date
  description: String!
  technicianName: String
}

# =====================================================
# CONNECTION TYPES
# =====================================================

type ProductionOrderConnection {
  edges: [ProductionOrderEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type ProductionOrderEdge {
  node: ProductionOrder!
  cursor: String!
}

# =====================================================
# PDF PREFLIGHT & COLOR MANAGEMENT TYPES
# =====================================================
# REQ: REQ-STRATEGIC-AUTO-1767066329942 - PDF Preflight & Color Management

"""
PreflightProfile - PDF validation rules (PDF/X-1a, PDF/X-3, custom)
"""
type PreflightProfile {
  id: ID!
  tenantId: ID!

  # Profile identification
  profileName: String!
  profileType: PreflightProfileType!

  # Version management
  version: Int!
  versionNotes: String
  supersededBy: ID
  effectiveFrom: DateTime!
  effectiveUntil: DateTime

  # Validation rules
  rules: JSON!

  # Profile settings
  isDefault: Boolean!
  isActive: Boolean!
  description: String

  # Audit
  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

"""
PreflightReport - PDF validation results
"""
type PreflightReport {
  id: ID!
  tenantId: ID!

  # References
  jobId: ID
  estimateId: ID
  artworkFileId: ID!

  # File information
  fileName: String!
  fileSizeBytes: Float
  fileHash: String

  # Profile used
  preflightProfile: PreflightProfile!
  profileVersion: Int!

  # Overall status
  status: PreflightStatus!

  # Validation results summary
  totalErrors: Int!
  totalWarnings: Int!
  totalInfo: Int!

  # Detailed issues
  issues: [PreflightIssue!]!

  # PDF metadata
  pdfMetadata: PdfMetadata
  colorAnalysis: ColorAnalysis
  imageAnalysis: ImageAnalysis
  fontAnalysis: FontAnalysis
  dimensions: PdfDimensions

  # Processing metrics
  processingTimeMs: Int
  processedAt: DateTime

  # Approval workflow
  approvedBy: ID
  approvedAt: DateTime
  rejectedBy: ID
  rejectedAt: DateTime
  rejectionReason: String
  approvalNotes: String

  # Audit
  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

"""
PreflightIssue - Individual validation error/warning
"""
type PreflightIssue {
  id: ID!
  preflightReportId: ID!

  # Classification
  issueType: IssueType!
  errorCode: String!
  severity: IssueSeverity!

  # Location
  pageNumber: Int
  elementType: String

  # Details
  message: String!
  suggestedFix: String

  # Element identification
  elementName: String
  elementMetadata: JSON

  createdAt: DateTime!
}

"""
PreflightArtifact - Generated artifacts (proofs, separations, etc.)
"""
type PreflightArtifact {
  id: ID!
  preflightReportId: ID!

  # Artifact type
  artifactType: ArtifactType!

  # Storage location
  storageProvider: String
  storageBucket: String
  storageKey: String
  storageUrl: String

  # File metadata
  fileSizeBytes: Float
  fileFormat: String
  contentHash: String

  # Lifecycle
  storageTier: StorageTier!
  expiresAt: DateTime

  createdAt: DateTime!
}

"""
ColorProof - Color accuracy validation and proof approval
"""
type ColorProof {
  id: ID!
  tenantId: ID!
  jobId: ID!
  preflightReportId: ID

  # Proof generation
  proofType: ProofType!
  proofFileUrl: String
  proofGeneratedAt: DateTime

  # Color management settings
  targetIccProfile: String
  renderingIntent: RenderingIntent

  # Color accuracy measurements
  deltaEMeasurements: JSON
  avgDeltaE: Float
  maxDeltaE: Float

  # Approval workflow
  status: ProofStatus!
  approvedBy: ID
  approvedAt: DateTime
  rejectedBy: ID
  rejectedAt: DateTime
  rejectionNotes: String

  # Audit
  createdAt: DateTime!
  createdBy: ID
  updatedAt: DateTime
  updatedBy: ID
}

"""
PDF Metadata - Basic PDF file information
"""
type PdfMetadata {
  pdfVersion: String
  pageCount: Int
  trimWidthInches: Float
  trimHeightInches: Float
  bleedInches: Float
}

"""
Color Analysis - Color space and ICC profile information
"""
type ColorAnalysis {
  colorSpace: String
  iccProfileEmbedded: String
  spotColors: JSON
  maxInkCoverage: Float
}

"""
Image Analysis - Image resolution statistics
"""
type ImageAnalysis {
  totalImages: Int!
  minResolutionDpi: Int
  avgResolutionDpi: Int
  lowResolutionImages: JSON
}

"""
Font Analysis - Font embedding information
"""
type FontAnalysis {
  fontsEmbedded: Boolean
  totalFonts: Int
  fontList: JSON
}

"""
PDF Dimensions - Trim box, bleed box dimensions
"""
type PdfDimensions {
  trimWidthInches: Float
  trimHeightInches: Float
  bleedInches: Float
}

"""
Preflight Statistics - Aggregate metrics
"""
type PreflightStatistics {
  tenantId: ID!
  totalReports: Int!
  passed: Int!
  passedWithWarnings: Int!
  failed: Int!
  passRatePercent: Float!
  avgProcessingTimeMs: Float
}

"""
Error Frequency - Common preflight errors
"""
type ErrorFrequency {
  errorCode: String!
  severity: IssueSeverity!
  errorCount: Int!
  lastOccurrence: DateTime!
  exampleMessages: [String!]!
}

# =====================================================
# PREFLIGHT ENUMS
# =====================================================

enum PreflightProfileType {
  PDF_X_1A
  PDF_X_3
  PDF_X_4
  CUSTOM
}

enum PreflightStatus {
  QUEUED
  PROCESSING
  PASS
  PASS_WITH_WARNINGS
  FAIL
  ERROR
}

enum IssueType {
  ERROR
  WARNING
  INFO
}

enum IssueSeverity {
  CRITICAL
  MAJOR
  MINOR
}

enum ArtifactType {
  ANNOTATED_PDF
  SOFT_PROOF
  DIGITAL_PROOF
  COLOR_SEPARATION
  THUMBNAIL
}

enum StorageTier {
  STANDARD
  INFREQUENT_ACCESS
  GLACIER
  DEEP_ARCHIVE
}

enum ProofType {
  SOFT_PROOF
  DIGITAL_PROOF
  CONTRACT_PROOF
}

enum RenderingIntent {
  PERCEPTUAL
  RELATIVE_COLORIMETRIC
  SATURATION
  ABSOLUTE_COLORIMETRIC
}

enum ProofStatus {
  pending
  approved
  rejected
  revision_requested
}

# =====================================================
# PREFLIGHT QUERIES
# =====================================================

extend type Query {
  """Get preflight profile by ID"""
  preflightProfile(id: ID!): PreflightProfile

  """List preflight profiles for tenant"""
  preflightProfiles(
    tenantId: ID!
    profileType: PreflightProfileType
    isActive: Boolean
  ): [PreflightProfile!]!

  """Get preflight report by ID"""
  preflightReport(id: ID!): PreflightReport

  """List preflight reports"""
  preflightReports(
    tenantId: ID!
    jobId: ID
    status: PreflightStatus
    limit: Int
    offset: Int
  ): [PreflightReport!]!

  """Get preflight issues for a report"""
  preflightIssues(reportId: ID!): [PreflightIssue!]!

  """Get color proof by ID"""
  colorProof(id: ID!): ColorProof

  """List color proofs for a job"""
  colorProofs(jobId: ID!): [ColorProof!]!

  """Get preflight statistics for tenant"""
  preflightStatistics(tenantId: ID!): PreflightStatistics!

  """Get most common preflight errors"""
  preflightErrorFrequency(
    tenantId: ID!
    limit: Int
  ): [ErrorFrequency!]!
}

# =====================================================
# PREFLIGHT MUTATIONS
# =====================================================

extend type Mutation {
  """Create preflight profile"""
  createPreflightProfile(input: CreatePreflightProfileInput!): PreflightProfile!

  """Update preflight profile"""
  updatePreflightProfile(id: ID!, input: UpdatePreflightProfileInput!): PreflightProfile!

  """Validate PDF file against preflight profile"""
  validatePdf(input: ValidatePdfInput!): PreflightReport!

  """Approve preflight report"""
  approvePreflightReport(id: ID!, notes: String): PreflightReport!

  """Reject preflight report"""
  rejectPreflightReport(id: ID!, reason: String!): PreflightReport!

  """Generate color proof"""
  generateColorProof(input: GenerateColorProofInput!): ColorProof!

  """Approve color proof"""
  approveColorProof(id: ID!): ColorProof!

  """Reject color proof"""
  rejectColorProof(id: ID!, notes: String!): ColorProof!
}

# =====================================================
# PREFLIGHT INPUT TYPES
# =====================================================

input CreatePreflightProfileInput {
  profileName: String!
  profileType: PreflightProfileType!
  rules: JSON!
  isDefault: Boolean
  description: String
}

input UpdatePreflightProfileInput {
  profileName: String
  rules: JSON
  isDefault: Boolean
  isActive: Boolean
  description: String
  versionNotes: String
}

input ValidatePdfInput {
  artworkFileId: ID!
  jobId: ID
  estimateId: ID
  profileId: ID!
  fileName: String!
}

input GenerateColorProofInput {
  jobId: ID!
  preflightReportId: ID
  proofType: ProofType!
  targetIccProfile: String
  renderingIntent: RenderingIntent
}
