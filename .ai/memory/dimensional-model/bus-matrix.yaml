# KIMBALL BUS MATRIX - Semantic Memory
# Purpose: Define which dimensions are used by which fact tables
# Usage: AI agents query "What dimensions does fact_sales_orders use?"

type: dimensional_model_memory
category: bus_matrix
version: "1.0"
last_updated: "2025-12-17"

# What is a Bus Matrix?
bus_matrix_definition:
  name: "Kimball Bus Matrix"
  purpose: "Map business processes (rows) to conformed dimensions (columns)"
  benefit: "Ensure dimensional consistency across enterprise"
  visualization: "Grid with âœ“ marks showing dimension usage"

# Business Processes (Fact Tables) - Rows
business_processes:

  sales_orders:
    fact_table: "fact_sales_orders"
    grain: "One row per sales order line"
    grain_detail: "Most atomic level: individual line item on sales order"
    fact_type: "Transaction fact"

    dimensions_used:
      - date              # order_date
      - customer
      - product
      - facility
      - sales_rep         # from Employee dimension
      - payment_terms     # degenerate or mini-dimension

    degenerate_dimensions:
      - sales_order_number
      - line_number
      - customer_po_number

    facts:
      - quantity_ordered  # additive
      - quantity_shipped  # additive
      - quantity_invoiced # additive
      - unit_price        # semi-additive
      - line_amount       # additive
      - discount_amount   # additive
      - line_cost         # additive
      - line_margin       # additive

    business_questions:
      - "Revenue by customer/product/region/time?"
      - "Average deal size by sales rep?"
      - "Discount effectiveness by product category?"

  quotes:
    fact_table: "fact_quotes"
    grain: "One row per quote line"
    fact_type: "Transaction fact"

    dimensions_used:
      - date              # quote_date
      - customer
      - product
      - facility
      - sales_rep

    degenerate_dimensions:
      - quote_number
      - line_number

    facts:
      - quantity_quoted   # additive
      - unit_price        # semi-additive
      - line_amount       # additive
      - unit_cost         # semi-additive
      - line_margin       # additive
      - margin_percentage # non-additive

    business_questions:
      - "Quote-to-order conversion rate?"
      - "Average quote value?"
      - "Time from quote to order?"

  invoices:
    fact_table: "fact_invoices"
    grain: "One row per invoice line"
    fact_type: "Transaction fact"

    dimensions_used:
      - date              # invoice_date
      - customer
      - product
      - facility
      - payment_terms

    degenerate_dimensions:
      - invoice_number
      - line_number

    facts:
      - quantity_invoiced # additive
      - unit_price        # semi-additive
      - line_amount       # additive
      - tax_amount        # additive
      - balance_due       # semi-additive

    business_questions:
      - "Revenue recognized by month?"
      - "AR aging by customer?"
      - "Days Sales Outstanding (DSO)?"

  customer_rejections:
    fact_table: "fact_customer_rejections"
    grain: "One row per rejection"
    fact_type: "Transaction fact"

    dimensions_used:
      - date              # rejection_date
      - customer
      - product
      - facility

    degenerate_dimensions:
      - rejection_number

    facts:
      - quantity_rejected # additive
      - financial_impact  # additive

    business_questions:
      - "Rejection rate by customer?"
      - "Cost of quality (external failure)?"

  production_runs:
    fact_table: "fact_production_runs"
    grain: "One row per production run"
    fact_type: "Transaction fact"

    dimensions_used:
      - date              # production_date
      - time_of_day       # shift
      - product
      - facility
      - work_center
      - employee          # operator

    degenerate_dimensions:
      - production_run_number
      - lot_number

    facts:
      - planned_quantity  # additive
      - good_quantity     # additive
      - scrap_quantity    # additive
      - rework_quantity   # additive
      - setup_time_minutes # additive
      - run_time_minutes  # additive
      - downtime_minutes  # additive
      - total_labor_cost  # additive

    business_questions:
      - "OEE by work center/product/shift?"
      - "Scrap rate trends?"
      - "Production throughput?"

  oee_metrics:
    fact_table: "fact_oee"
    grain: "One row per work center per day"
    fact_type: "Periodic snapshot fact"

    dimensions_used:
      - date
      - facility
      - work_center

    facts:
      - availability_percent  # non-additive
      - performance_percent   # non-additive
      - quality_percent       # non-additive
      - oee_percent          # non-additive

    business_questions:
      - "OEE trends over time?"
      - "Best/worst performing work centers?"

  quality_inspections:
    fact_table: "fact_quality_inspections"
    grain: "One row per inspection"
    fact_type: "Transaction fact"

    dimensions_used:
      - date              # inspection_date
      - time_of_day
      - product
      - material
      - facility
      - work_center
      - employee          # inspector

    degenerate_dimensions:
      - inspection_number
      - lot_number

    facts:
      - sample_size       # additive
      - defects_found     # additive
      - pass_fail_flag    # non-additive

    business_questions:
      - "First-pass yield by product?"
      - "Defect rate by inspector?"

  defects:
    fact_table: "fact_defects"
    grain: "One row per defect"
    fact_type: "Transaction fact"

    dimensions_used:
      - date              # defect_date
      - product
      - facility
      - work_center
      - employee          # responsible

    degenerate_dimensions:
      - defect_number

    facts:
      - quantity_affected # additive

    business_questions:
      - "Defect rate by product/work center?"
      - "CAPA closure time?"

  labor_tracking:
    fact_table: "fact_labor"
    grain: "One row per employee per production run per labor type"
    fact_type: "Transaction fact"

    dimensions_used:
      - date              # work_date
      - time_of_day       # shift_start
      - employee
      - product
      - facility
      - work_center

    degenerate_dimensions:
      - production_run_number
      - labor_type        # SETUP, RUN, CLEANUP, REWORK

    facts:
      - hours_worked      # additive
      - hourly_rate       # non-additive
      - total_labor_cost  # additive

    business_questions:
      - "Labor cost by product/work center?"
      - "Labor efficiency trends?"

  purchase_orders:
    fact_table: "fact_purchase_orders"
    grain: "One row per PO line"
    fact_type: "Transaction fact"

    dimensions_used:
      - date              # purchase_order_date
      - material
      - facility
      - vendor
      - payment_terms

    degenerate_dimensions:
      - purchase_order_number
      - line_number

    facts:
      - quantity_ordered  # additive
      - quantity_received # additive
      - unit_price        # semi-additive
      - line_amount       # additive

    business_questions:
      - "Spend by vendor/material?"
      - "Price variance analysis?"

  receipts:
    fact_table: "fact_receipts"
    grain: "One row per receipt transaction"
    fact_type: "Transaction fact"

    dimensions_used:
      - date              # receipt_date
      - time_of_day
      - material
      - facility
      - employee          # receiver
      - vendor

    degenerate_dimensions:
      - receipt_number

    facts:
      - quantity_received # additive
      - unit_cost         # semi-additive
      - extended_value    # additive

  vendor_performance:
    fact_table: "fact_vendor_performance"
    grain: "One row per vendor per month"
    fact_type: "Periodic snapshot fact"

    dimensions_used:
      - date              # month-end date
      - vendor

    facts:
      - total_pos_issued  # additive
      - total_pos_value   # additive
      - on_time_deliveries # additive
      - total_deliveries  # additive
      - on_time_percentage # non-additive
      - quality_percentage # non-additive
      - overall_rating    # non-additive

  inventory_transactions:
    fact_table: "fact_inventory_transactions"
    grain: "One row per inventory movement"
    fact_type: "Transaction fact"

    dimensions_used:
      - date              # transaction_date
      - time_of_day
      - product
      - material
      - facility
      - employee          # performed_by
      - security_zone     # from/to location

    degenerate_dimensions:
      - transaction_number

    facts:
      - quantity          # additive
      - unit_cost         # semi-additive
      - extended_value    # additive

  inventory_snapshots:
    fact_table: "fact_inventory_snapshots"
    grain: "One row per material per location per day"
    fact_type: "Periodic snapshot fact"

    dimensions_used:
      - date              # snapshot_date
      - material
      - facility
      - security_zone

    facts:
      - quantity_on_hand  # semi-additive (additive across location, not time)
      - quantity_allocated # semi-additive
      - quantity_available # semi-additive
      - standard_cost     # non-additive
      - extended_value    # semi-additive

    business_questions:
      - "Inventory value by location?"
      - "Inventory turns by material?"
      - "Slow-moving inventory?"

  lot_traceability:
    fact_table: "fact_lot_traceability"
    grain: "One row per lot movement"
    fact_type: "Transaction fact"

    dimensions_used:
      - date
      - customer
      - product
      - material
      - facility
      - vendor

    degenerate_dimensions:
      - lot_number

    facts:
      - quantity          # additive

    business_questions:
      - "Recall scope: which customers got lot X?"
      - "Supplier traceability?"

  wave_processing:
    fact_table: "fact_waves"
    grain: "One row per wave"
    fact_type: "Transaction fact"

    dimensions_used:
      - date
      - time_of_day
      - customer
      - product
      - facility
      - employee          # picker

    degenerate_dimensions:
      - wave_number

    facts:
      - lines_picked      # additive
      - units_picked      # additive
      - pick_time_minutes # additive

  shipments:
    fact_table: "fact_shipments"
    grain: "One row per shipment line"
    fact_type: "Transaction fact"

    dimensions_used:
      - date              # shipment_date
      - time_of_day
      - customer
      - product
      - facility
      - employee          # packer
      - carrier

    degenerate_dimensions:
      - shipment_number
      - tracking_number

    facts:
      - quantity_shipped  # additive
      - weight_lbs        # additive
      - freight_cost      # additive

  cycle_counts:
    fact_table: "fact_cycle_counts"
    grain: "One row per cycle count"
    fact_type: "Transaction fact"

    dimensions_used:
      - date
      - time_of_day
      - material
      - facility
      - employee          # counter
      - security_zone

    facts:
      - quantity_expected # additive
      - quantity_counted  # additive
      - quantity_variance # additive

  gl_transactions:
    fact_table: "fact_gl_transactions"
    grain: "One row per journal entry line"
    fact_type: "Transaction fact"

    dimensions_used:
      - date              # posting_date
      - customer          # if AR
      - product           # if inventory-related
      - vendor            # if AP
      - facility
      - account           # chart of accounts dimension

    degenerate_dimensions:
      - journal_entry_number
      - line_number

    facts:
      - debit_amount      # additive (always positive)
      - credit_amount     # additive (always positive)

  ar_aging:
    fact_table: "fact_ar_aging"
    grain: "One row per customer per aging bucket per day"
    fact_type: "Periodic snapshot fact"

    dimensions_used:
      - date              # as_of_date
      - customer
      - payment_terms

    facts:
      - current_amount    # semi-additive
      - days30_amount     # semi-additive
      - days60_amount     # semi-additive
      - days90_amount     # semi-additive
      - over90_amount     # semi-additive
      - total_due         # semi-additive

  ap_aging:
    fact_table: "fact_ap_aging"
    grain: "One row per vendor per aging bucket per day"
    fact_type: "Periodic snapshot fact"

    dimensions_used:
      - date
      - vendor
      - payment_terms

    facts:
      - current_amount    # semi-additive
      - days30_amount     # semi-additive
      - days60_amount     # semi-additive
      - days90_amount     # semi-additive
      - over90_amount     # semi-additive
      - total_due         # semi-additive

  cost_allocations:
    fact_table: "fact_cost_allocations"
    grain: "One row per cost allocation"
    fact_type: "Transaction fact"

    dimensions_used:
      - date
      - product
      - facility
      - work_center

    facts:
      - material_cost     # additive
      - labor_cost        # additive
      - overhead_cost     # additive
      - total_cost        # additive

  marketplace_job_postings:
    fact_table: "fact_marketplace_jobs"
    grain: "One row per job posting"
    fact_type: "Transaction fact"

    dimensions_used:
      - date              # posting_date
      - product
      - partner_company   # posting company

    degenerate_dimensions:
      - posting_number

    facts:
      - quantity_required # additive
      - estimated_budget  # additive

  marketplace_bids:
    fact_table: "fact_marketplace_bids"
    grain: "One row per bid"
    fact_type: "Transaction fact"

    dimensions_used:
      - date              # bid_date
      - time_of_day
      - product
      - partner_company   # bidding company

    degenerate_dimensions:
      - bid_number

    facts:
      - bid_amount        # additive

  external_company_orders:
    fact_table: "fact_external_orders"
    grain: "One row per external order"
    fact_type: "Transaction fact"

    dimensions_used:
      - date              # order_date
      - product
      - partner_company   # originating (2 roles: originating & fulfilling)

    degenerate_dimensions:
      - order_number

    facts:
      - quantity_ordered  # additive
      - order_amount      # additive

  sensor_readings:
    fact_table: "fact_sensor_readings"
    grain: "One row per sensor reading"
    fact_type: "Transaction fact (time-series)"

    dimensions_used:
      - date
      - time_of_day       # minute/second grain
      - facility
      - work_center
      - iot_device

    facts:
      - reading_value     # type depends on sensor

    business_questions:
      - "Temperature trends during production?"
      - "Equipment performance over time?"

  equipment_events:
    fact_table: "fact_equipment_events"
    grain: "One row per equipment event"
    fact_type: "Transaction fact"

    dimensions_used:
      - date
      - time_of_day
      - facility
      - work_center
      - iot_device

    degenerate_dimensions:
      - event_code

    facts:
      - downtime_minutes  # additive (if event type = DOWNTIME)

  security_access_log:
    fact_table: "fact_security_access"
    grain: "One row per access attempt"
    fact_type: "Transaction fact"

    dimensions_used:
      - date
      - time_of_day
      - facility
      - employee
      - security_zone

    facts:
      - access_granted_count  # additive (1 or 0)
      - access_denied_count   # additive (1 or 0)

  chain_of_custody:
    fact_table: "fact_chain_of_custody"
    grain: "One row per custody transfer"
    fact_type: "Transaction fact"

    dimensions_used:
      - date
      - time_of_day
      - customer
      - product
      - facility
      - employee          # from_user, to_user
      - security_zone     # from_location, to_location

    facts:
      - transfer_count    # additive (always 1)

  timecards:
    fact_table: "fact_timecards"
    grain: "One row per employee per day"
    fact_type: "Transaction fact"

    dimensions_used:
      - date              # timecard_date
      - time_of_day       # clock_in
      - employee
      - facility
      - work_center

    facts:
      - regular_hours     # additive
      - overtime_hours    # additive
      - double_time_hours # additive

  labor_costs:
    fact_table: "fact_labor_costs"
    grain: "One row per employee per job"
    fact_type: "Transaction fact"

    dimensions_used:
      - date
      - product
      - facility
      - work_center
      - employee

    facts:
      - hours_worked      # additive
      - labor_cost        # additive

# Conformed Dimensions (Columns in Bus Matrix)
conformed_dimensions:
  - name: date
    used_by_fact_count: 30  # Nearly all facts

  - name: time_of_day
    used_by_fact_count: 15  # High-frequency events

  - name: customer
    used_by_fact_count: 10  # Sales, AR, shipments, etc.

  - name: product
    used_by_fact_count: 12  # Sales, production, quality, etc.

  - name: material
    used_by_fact_count: 8   # Purchasing, inventory, production

  - name: facility
    used_by_fact_count: 25  # Nearly all facts

  - name: work_center
    used_by_fact_count: 10  # Manufacturing facts

  - name: employee
    used_by_fact_count: 12  # Labor, quality, warehouse, security

  - name: vendor
    used_by_fact_count: 5   # Purchasing, AP

  - name: carrier
    used_by_fact_count: 2   # Shipments

  - name: security_zone
    used_by_fact_count: 5   # Inventory, security, chain of custody

  - name: partner_company
    used_by_fact_count: 3   # Marketplace facts

  - name: payment_terms
    used_by_fact_count: 5   # AR, AP, sales, purchasing

# AI Query Examples
ai_query_examples:

  - query: "What dimensions does fact_sales_orders use?"
    answer: "date, customer, product, facility, sales_rep, payment_terms"

  - query: "What is the grain of fact_inventory_snapshots?"
    answer: "One row per material per location per day (periodic snapshot)"

  - query: "Which facts use the Employee dimension?"
    answer: "labor_tracking, quality_inspections, timecards, security_access, cycle_counts, receipts, shipments, wave_processing, chain_of_custody"

  - query: "What business questions can fact_production_runs answer?"
    answer: "OEE by work center/product/shift, scrap rate trends, production throughput"

  - query: "How are Customer and Product related in OLAP?"
    answer: "Both are conformed dimensions used by sales_orders, quotes, invoices facts. Enables drill-across: 'How does product quality affect customer satisfaction?'"

# Memory Metadata
memory_metadata:
  embeddings_needed: true
  searchable_fields:
    - business_process_names
    - fact_table_names
    - dimension_names
    - business_questions
    - fact_grains
  importance: "CRITICAL - defines entire OLAP architecture"
  version_history:
    - version: "1.0"
      date: "2025-12-17"
      changes: "Initial Bus Matrix definition with 30+ fact tables"
