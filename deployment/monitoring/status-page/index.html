<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AgogSaaS System Status</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .status-card {
      background: white;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .overall-status {
      text-align: center;
      padding: 40px;
    }

    .status-indicator {
      display: inline-block;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin-bottom: 20px;
    }

    .status-indicator.operational {
      background: #10b981;
      animation: pulse-green 2s infinite;
    }

    .status-indicator.degraded {
      background: #f59e0b;
      animation: pulse-yellow 2s infinite;
    }

    .status-indicator.down {
      background: #ef4444;
      animation: pulse-red 2s infinite;
    }

    @keyframes pulse-green {
      0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
      50% { box-shadow: 0 0 0 20px rgba(16, 185, 129, 0); }
    }

    @keyframes pulse-yellow {
      0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.7); }
      50% { box-shadow: 0 0 0 20px rgba(245, 158, 11, 0); }
    }

    @keyframes pulse-red {
      0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
      50% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); }
    }

    .overall-status h2 {
      font-size: 2em;
      margin-bottom: 10px;
      color: #1f2937;
    }

    .overall-status p {
      color: #6b7280;
      font-size: 1.1em;
    }

    .services-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .service-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px;
      background: #f9fafb;
      border-radius: 8px;
      border-left: 4px solid #e5e7eb;
    }

    .service-item.operational {
      border-left-color: #10b981;
    }

    .service-item.degraded {
      border-left-color: #f59e0b;
    }

    .service-item.down {
      border-left-color: #ef4444;
    }

    .service-info {
      flex: 1;
    }

    .service-name {
      font-weight: 600;
      font-size: 1.1em;
      color: #1f2937;
      margin-bottom: 5px;
    }

    .service-description {
      font-size: 0.9em;
      color: #6b7280;
    }

    .service-status {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-badge {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.85em;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-badge.operational {
      background: #d1fae5;
      color: #065f46;
    }

    .status-badge.degraded {
      background: #fef3c7;
      color: #92400e;
    }

    .status-badge.down {
      background: #fee2e2;
      color: #991b1b;
    }

    .uptime {
      font-size: 0.9em;
      color: #6b7280;
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .metric-card {
      text-align: center;
      padding: 20px;
      background: #f9fafb;
      border-radius: 8px;
    }

    .metric-value {
      font-size: 2em;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 5px;
    }

    .metric-label {
      font-size: 0.9em;
      color: #6b7280;
    }

    .incidents {
      margin-top: 30px;
    }

    .incidents h3 {
      font-size: 1.5em;
      margin-bottom: 20px;
      color: #1f2937;
    }

    .incident-item {
      padding: 20px;
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
      border-radius: 8px;
      margin-bottom: 15px;
    }

    .incident-item.resolved {
      background: #d1fae5;
      border-left-color: #10b981;
    }

    .incident-title {
      font-weight: 600;
      font-size: 1.1em;
      margin-bottom: 5px;
      color: #1f2937;
    }

    .incident-description {
      color: #6b7280;
      margin-bottom: 10px;
    }

    .incident-time {
      font-size: 0.85em;
      color: #9ca3af;
    }

    .footer {
      text-align: center;
      color: white;
      margin-top: 40px;
      opacity: 0.8;
    }

    .refresh-info {
      text-align: center;
      color: white;
      font-size: 0.9em;
      margin-top: 20px;
      opacity: 0.7;
    }

    .last-updated {
      text-align: right;
      color: #6b7280;
      font-size: 0.85em;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>AgogSaaS System Status</h1>
      <p>Real-time system health and performance monitoring</p>
    </div>

    <div class="status-card">
      <div class="overall-status">
        <div class="status-indicator operational" id="overallIndicator"></div>
        <h2 id="overallStatusText">All Systems Operational</h2>
        <p id="overallStatusDescription">All services are running smoothly</p>
      </div>

      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-value" id="uptime">99.98%</div>
          <div class="metric-label">Uptime (30 days)</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="responseTime">145ms</div>
          <div class="metric-label">Avg Response Time</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="activeUsers">--</div>
          <div class="metric-label">Active Users</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="edgeFacilities">--</div>
          <div class="metric-label">Edge Facilities Online</div>
        </div>
      </div>
    </div>

    <div class="status-card">
      <h3 style="margin-bottom: 20px; color: #1f2937; font-size: 1.5em;">Service Status</h3>
      <div class="services-grid" id="servicesGrid">
        <!-- Services will be loaded here via JavaScript -->
      </div>
      <div class="last-updated">Last updated: <span id="lastUpdated">--</span></div>
    </div>

    <div class="status-card incidents">
      <h3>Recent Incidents</h3>
      <div id="incidentsContainer">
        <p style="color: #6b7280;">No incidents in the last 7 days</p>
      </div>
    </div>

    <div class="refresh-info">
      Page auto-refreshes every 30 seconds
    </div>

    <div class="footer">
      <p>&copy; 2024 AgogSaaS. All rights reserved.</p>
      <p style="margin-top: 10px; font-size: 0.9em;">
        <a href="https://grafana.agogsaas.com" style="color: white;">Monitoring Dashboard</a> |
        <a href="https://docs.agogsaas.com/status" style="color: white;">Status API</a>
      </p>
    </div>
  </div>

  <script>
    // Service definitions
    const services = [
      { name: 'GraphQL API', description: 'Core API services', key: 'api' },
      { name: 'PostgreSQL Database', description: 'Primary database', key: 'database' },
      { name: 'NATS Messaging', description: 'Event streaming', key: 'nats' },
      { name: 'Redis Cache', description: 'Caching layer', key: 'redis' },
      { name: 'Edge Sync', description: 'Facility synchronization', key: 'edge-sync' },
      { name: 'Authentication', description: 'User authentication', key: 'auth' },
      { name: 'Marketplace', description: 'Job marketplace', key: 'marketplace' },
      { name: 'File Storage', description: 'Document storage', key: 'storage' },
    ];

    // Fetch status from Prometheus/backend
    async function fetchStatus() {
      try {
        // In production, this would fetch from your monitoring API
        // For now, simulate with mock data
        const response = await fetch('/api/status').catch(() => null);

        if (response && response.ok) {
          const data = await response.json();
          updateStatus(data);
        } else {
          // Use mock data for demo
          updateStatus(getMockStatus());
        }
      } catch (error) {
        console.error('Failed to fetch status:', error);
        updateStatus(getMockStatus());
      }
    }

    function getMockStatus() {
      return {
        overall: 'operational',
        services: services.map(s => ({ ...s, status: 'operational', uptime: '99.9%' })),
        metrics: {
          uptime: '99.98%',
          responseTime: '145ms',
          activeUsers: 234,
          edgeFacilities: 12,
        },
        incidents: []
      };
    }

    function updateStatus(data) {
      // Update overall status
      const indicator = document.getElementById('overallIndicator');
      const statusText = document.getElementById('overallStatusText');
      const statusDesc = document.getElementById('overallStatusDescription');

      indicator.className = `status-indicator ${data.overall}`;

      if (data.overall === 'operational') {
        statusText.textContent = 'All Systems Operational';
        statusDesc.textContent = 'All services are running smoothly';
      } else if (data.overall === 'degraded') {
        statusText.textContent = 'Degraded Performance';
        statusDesc.textContent = 'Some services experiencing issues';
      } else {
        statusText.textContent = 'Service Disruption';
        statusDesc.textContent = 'Critical services are down';
      }

      // Update metrics
      document.getElementById('uptime').textContent = data.metrics.uptime;
      document.getElementById('responseTime').textContent = data.metrics.responseTime;
      document.getElementById('activeUsers').textContent = data.metrics.activeUsers;
      document.getElementById('edgeFacilities').textContent = data.metrics.edgeFacilities;

      // Update services
      const servicesGrid = document.getElementById('servicesGrid');
      servicesGrid.innerHTML = data.services.map(service => `
        <div class="service-item ${service.status}">
          <div class="service-info">
            <div class="service-name">${service.name}</div>
            <div class="service-description">${service.description}</div>
          </div>
          <div class="service-status">
            <div class="uptime">${service.uptime}</div>
            <span class="status-badge ${service.status}">
              ${service.status}
            </span>
          </div>
        </div>
      `).join('');

      // Update incidents
      const incidentsContainer = document.getElementById('incidentsContainer');
      if (data.incidents && data.incidents.length > 0) {
        incidentsContainer.innerHTML = data.incidents.map(incident => `
          <div class="incident-item ${incident.resolved ? 'resolved' : ''}">
            <div class="incident-title">${incident.title}</div>
            <div class="incident-description">${incident.description}</div>
            <div class="incident-time">${incident.time}</div>
          </div>
        `).join('');
      } else {
        incidentsContainer.innerHTML = '<p style="color: #6b7280;">No incidents in the last 7 days</p>';
      }

      // Update timestamp
      document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
    }

    // Initial load
    fetchStatus();

    // Auto-refresh every 30 seconds
    setInterval(fetchStatus, 30000);
  </script>
</body>
</html>
